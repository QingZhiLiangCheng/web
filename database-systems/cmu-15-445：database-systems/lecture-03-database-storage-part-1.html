<!DOCTYPE html> <html><head>
		<title>Lecture 03 Database Storage Part 1</title>
		<base href="..\../">
		<meta id="root-path" root-path="..\../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="QingZhiLiangCheng - Lecture 03 Database Storage Part 1">
		<meta property="og:title" content="Lecture 03 Database Storage Part 1">
		<meta property="og:description" content="QingZhiLiangCheng - Lecture 03 Database Storage Part 1">
		<meta property="og:type" content="website">
		<meta property="og:url" content="https://qingzhiliangcheng.cn/database-systems/cmu-15-445：database-systems/lecture-03-database-storage-part-1.html">
		<meta property="og:image" content="https://qingzhiliangcheng.cn/lib/media/pasted-image-20250122091100.png">
		<meta property="og:site_name" content="QingZhiLiangCheng">
		<meta name="author" content="QingZhiLiangCheng"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.png"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="preload" href="lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/other-plugins.css"></noscript><link rel="stylesheet" href="lib/styles/theme.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/supported-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/supported-plugins.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript><link rel="preload" href="lib/styles/snippets.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/snippets.css"></noscript></head><body class="publish css-settings-manager theme-light show-inline-title show-ribbon mk-readable-line mk-folder-lines mk-spaces-enabled mk-inline-context-enabled mk-flow-minimal background-settings-workplace-theme-light-custom-option background-settings-workplace-theme-dark-in-the-sky background-image-settings-switch toggle-nonoverlapping-bg background-image-settings-markdown-page-custom notebook-liked-markdown-page-grid-notebook-2 background-image-settings-command-palette-switch background-image-settings-command-palette-same-as-workplace toggle-bg-panel-page panel-page-bg-theme-light-wall panel-page-bg-theme-dark-plant layout-style-options-default clutter-free-headings bt-default-unordered-list default-ol-list-marker list-no-border bt-connected-indent-hover bt-colorful-connected-indent-hover folder-icons remove-arrow bt-toggle-colorful-folder folder-style-change-options-colorful-border folder-colorful-six table-width-100 tag-default admonition-bg-color-same style-options-for-admonition-plugin style-options-for-buttons-plugin dataview-list-style-pacman memos-banner-gradient thino-frosted-style thino-background-default quiet-outline-optimize code-theme-custom code-line-number whole-code-wrap"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles">mjx-c.mjx-c1D43E.TEX-I::before{padding:.683em .889em 0 0;content:"K"}mjx-c.mjx-c1D44A.TEX-I::before{padding:.683em 1.048em .022em 0;content:"W"}mjx-c.mjx-c1D70F.TEX-I::before{padding:.431em .517em .013em 0;content:"τ"}mjx-c.mjx-c394::before{padding:.716em .833em 0 0;content:"Δ"}mjx-c.mjx-c1D446.TEX-I::before{padding:.705em .645em .022em 0;content:"S"}mjx-c.mjx-c1D450.TEX-I::before{padding:.442em .433em .011em 0;content:"c"}mjx-c.mjx-c25::before{padding:.75em .833em .056em 0;content:"%"}mjx-c.mjx-cB7::before{padding:.31em .278em 0 0;content:"⋅"}.mjx-stretched mjx-c.mjx-c2013::before{content:"–"}mjx-stretchy-h.mjx-c2013 mjx-ext mjx-c::before{content:"–";padding:.285em 0 0}mjx-c.mjx-c24::before{padding:.75em .5em .056em 0;content:"$"}mjx-c.mjx-c1D45D.TEX-I::before{padding:.442em .503em .194em 0;content:"p"}mjx-c.mjx-c39::before{padding:.666em .5em .022em 0;content:"9"}mjx-stretchy-v.mjx-c7B mjx-beg mjx-c::before{content:"⎧";padding:.899em .889em .01em 0}mjx-stretchy-v.mjx-c7B mjx-ext mjx-c::before{content:"⎪";width:.889em}mjx-stretchy-v.mjx-c7B mjx-end mjx-c::before{content:"⎩";padding:.01em .889em .899em 0}mjx-stretchy-v.mjx-c7B mjx-mid mjx-c::before{content:"⎨";padding:1.16em .889em .66em 0}mjx-stretchy-v.mjx-c7B>mjx-mid{margin-top:-.91em;margin-bottom:-.91em}mjx-stretchy-v.mjx-c7B>mjx-end{margin-top:-.909em}mjx-stretchy-v.mjx-c7B>mjx-ext{height:50%;border-top-width:.879em;border-bottom-width:.879em}mjx-c.mjx-c1D463.TEX-I::before{padding:.443em .485em .011em 0;content:"v"}mjx-c.mjx-c1D443.TEX-I::before{padding:.683em .751em 0 0;content:"P"}mjx-c.mjx-c1D448.TEX-I::before{padding:.683em .767em .022em 0;content:"U"}mjx-c.mjx-c1D447.TEX-I::before{padding:.677em .704em 0 0;content:"T"}mjx-c.mjx-c2032::before{padding:.56em .275em 0 0;content:"′"}mjx-c.mjx-c22C5::before{padding:.31em .278em 0 0;content:"⋅"}mjx-c.mjx-c20D7.TEX-V::before{padding:.714em .5em 0 0;content:"→"}mjx-c.mjx-c1D435.TEX-I::before{padding:.683em .759em 0 0;content:"B"}mjx-c.mjx-c1D458.TEX-I::before{padding:.694em .521em .011em 0;content:"k"}mjx-c.mjx-c1D439.TEX-I::before{padding:.68em .749em 0 0;content:"F"}mjx-c.mjx-c3A::before{padding:.43em .278em 0 0;content:":"}mjx-c.mjx-c2033::before{padding:.56em .55em 0 0;content:"′′"}mjx-c.mjx-cAC::before{padding:.356em .667em 0 0;content:"¬"}mjx-c.mjx-c2227::before{padding:.598em .667em .022em 0;content:"∧"}mjx-c.mjx-c2228::before{padding:.598em .667em .022em 0;content:"∨"}mjx-c.mjx-c2295::before{padding:.583em .778em .083em 0;content:"⊕"}mjx-munderover{display:inline-block;text-align:left}mjx-munderover:not([limits=false]){padding-top:.1em}mjx-munderover:not([limits=false])>*{display:block}mjx-msubsup{display:inline-block;text-align:left}mjx-script{display:inline-block;padding-right:.05em;padding-left:.033em}mjx-script>mjx-spacer{display:block}mjx-mover{display:inline-block;text-align:left}mjx-mover:not([limits=false]){padding-top:.1em}mjx-mover:not([limits=false])>*{display:block;text-align:left}mjx-c.mjx-c1D449.TEX-I::before{padding:.683em .769em .022em 0;content:"V"}mjx-c.mjx-c1D466.TEX-I::before{padding:.442em .49em .205em 0;content:"y"}mjx-c.mjx-c1D451.TEX-I::before{padding:.694em .52em .01em 0;content:"d"}mjx-c.mjx-c2211.TEX-S2::before{padding:.95em 1.444em .45em 0;content:"∑"}mjx-c.mjx-c35::before{padding:.666em .5em .022em 0;content:"5"}mjx-c.mjx-c1D440.TEX-I::before{padding:.683em 1.051em 0 0;content:"M"}mjx-c.mjx-c1D438.TEX-I::before{padding:.68em .764em 0 0;content:"E"}mjx-c.mjx-c3C::before{padding:.54em .778em .04em 0;content:"<"}mjx-c.mjx-c1D462.TEX-I::before{padding:.442em .572em .011em 0;content:"u"}mjx-c.mjx-c5E::before{padding:.694em .5em 0 0;content:"^"}mjx-c.mjx-c7C::before{padding:.75em .278em .249em 0;content:"|"}mjx-c.mjx-c1D43C.TEX-I::before{padding:.683em .504em 0 0;content:"I"}mjx-c.mjx-c1D445.TEX-I::before{padding:.683em .759em .021em 0;content:"R"}mjx-c.mjx-c26::before{padding:.716em .778em .022em 0;content:"&"}mjx-c.mjx-c1D457.TEX-I::before{padding:.661em .412em .204em 0;content:"j"}mjx-c.mjx-c2217::before{padding:.465em .5em 0 0;content:"∗"}mjx-c.mjx-c1D434.TEX-I::before{padding:.716em .75em 0 0;content:"A"}mjx-c.mjx-c1D436.TEX-I::before{padding:.705em .76em .022em 0;content:"C"}mjx-c.mjx-c1D45A.TEX-I::before{padding:.442em .878em .011em 0;content:"m"}mjx-mtable{display:inline-block;text-align:center;vertical-align:.25em;position:relative;box-sizing:border-box;border-spacing:0px;border-collapse:collapse}mjx-mstyle[size="s"] mjx-mtable{vertical-align:.354em}mjx-labels{position:absolute;left:0;top:0}mjx-table{display:inline-block;vertical-align:-.5ex;box-sizing:border-box}mjx-table>mjx-itable{vertical-align:middle;text-align:left;box-sizing:border-box}mjx-labels>mjx-itable{position:absolute;top:0}mjx-mtable[justify=left]{text-align:left}mjx-mtable[justify=right]{text-align:right}mjx-mtable[justify=left][side=left]{padding-right:0!important}mjx-mtable[justify=left][side=right]{padding-left:0!important}mjx-mtable[justify=right][side=left]{padding-right:0!important}mjx-mtable[justify=right][side=right]{padding-left:0!important}mjx-mtable[align]{vertical-align:baseline}mjx-mtable[align=top]>mjx-table{vertical-align:top}mjx-mtable[align=bottom]>mjx-table{vertical-align:bottom}mjx-mtable[side=right] mjx-labels{min-width:100%}mjx-mtr{display:table-row;text-align:left}mjx-mtr[rowalign=top]>mjx-mtd{vertical-align:top}mjx-mtr[rowalign=center]>mjx-mtd{vertical-align:middle}mjx-mtr[rowalign=bottom]>mjx-mtd{vertical-align:bottom}mjx-mtr[rowalign=baseline]>mjx-mtd{vertical-align:baseline}mjx-mtr[rowalign=axis]>mjx-mtd{vertical-align:.25em}mjx-mtd{display:table-cell;text-align:center;padding:.215em .4em}mjx-mtd:first-child{padding-left:0}mjx-mtd:last-child{padding-right:0}mjx-mtable>*>mjx-itable>:first-child>mjx-mtd{padding-top:0}mjx-mtable>*>mjx-itable>:last-child>mjx-mtd{padding-bottom:0}mjx-tstrut{display:inline-block;height:1em;vertical-align:-.25em}mjx-labels[align=left]>mjx-mtr>mjx-mtd{text-align:left}mjx-labels[align=right]>mjx-mtr>mjx-mtd{text-align:right}mjx-mtd[extra]{padding:0}mjx-mtd[rowalign=top]{vertical-align:top}mjx-mtd[rowalign=center]{vertical-align:middle}mjx-mtd[rowalign=bottom]{vertical-align:bottom}mjx-mtd[rowalign=baseline]{vertical-align:baseline}mjx-mtd[rowalign=axis]{vertical-align:.25em}mjx-c.mjx-c36::before{padding:.666em .5em .022em 0;content:"6"}mjx-c.mjx-c1D456.TEX-I::before{padding:.661em .345em .011em 0;content:"i"}mjx-c.mjx-c1D453.TEX-I::before{padding:.705em .55em .205em 0;content:"f"}mjx-c.mjx-c1D437.TEX-I::before{padding:.683em .828em 0 0;content:"D"}mjx-c.mjx-c2F::before{padding:.75em .5em .25em 0;content:"/"}mjx-c.mjx-c2C::before{padding:.121em .278em .194em 0;content:","}mjx-c.mjx-c1D45F.TEX-I::before{padding:.442em .451em .011em 0;content:"r"}mjx-c.mjx-c3E::before{padding:.54em .778em .04em 0;content:">"}mjx-c.mjx-c1D464.TEX-I::before{padding:.443em .716em .011em 0;content:"w"}mjx-c.mjx-c1D461.TEX-I::before{padding:.626em .361em .011em 0;content:"t"}mjx-c.mjx-c210E.TEX-I::before{padding:.694em .576em .011em 0;content:"h"}mjx-c.mjx-c1D452.TEX-I::before{padding:.442em .466em .011em 0;content:"e"}mjx-c.mjx-c2248::before{padding:.483em .778em 0 0;content:"≈"}mjx-c.mjx-c37::before{padding:.676em .5em .022em 0;content:"7"}mjx-c.mjx-c1D460.TEX-I::before{padding:.442em .469em .01em 0;content:"s"}mjx-c.mjx-c1D467.TEX-I::before{padding:.442em .465em .011em 0;content:"z"}mjx-c.mjx-c21::before{padding:.716em .278em 0 0;content:"!"}mjx-c.mjx-c7B.TEX-S3::before{padding:1.45em .75em .949em 0;content:"{"}mjx-c.mjx-c1D43F.TEX-I::before{padding:.683em .681em 0 0;content:"L"}mjx-c.mjx-c2265::before{padding:.636em .778em .138em 0;content:"≥"}mjx-c.mjx-c2264::before{padding:.636em .778em .138em 0;content:"≤"}mjx-c.mjx-c30::before{padding:.666em .5em .022em 0;content:"0"}mjx-c.mjx-c1D44F.TEX-I::before{padding:.694em .429em .011em 0;content:"b"}mjx-c.mjx-c33::before{padding:.665em .5em .022em 0;content:"3"}mjx-c.mjx-c398::before{padding:.705em .778em .022em 0;content:"Θ"}mjx-c.mjx-c1D442.TEX-I::before{padding:.704em .763em .022em 0;content:"O"}mjx-c.mjx-c3A9::before{padding:.704em .722em 0 0;content:"Ω"}mjx-msub{display:inline-block;text-align:left}mjx-c.mjx-c1D459.TEX-I::before{padding:.694em .298em .011em 0;content:"l"}mjx-c.mjx-c1D45C.TEX-I::before{padding:.441em .485em .011em 0;content:"o"}mjx-c.mjx-c1D454.TEX-I::before{padding:.442em .477em .205em 0;content:"g"}mjx-c.mjx-c1D441.TEX-I::before{padding:.683em .888em 0 0;content:"N"}mjx-container[jax=CHTML]{line-height:0}mjx-container [space="1"]{margin-left:.111em}mjx-container [space="2"]{margin-left:.167em}mjx-container [space="3"]{margin-left:.222em}mjx-container [space="4"]{margin-left:.278em}mjx-container [space="5"]{margin-left:.333em}mjx-container [rspace="1"]{margin-right:.111em}mjx-container [rspace="2"]{margin-right:.167em}mjx-container [rspace="3"]{margin-right:.222em}mjx-container [rspace="4"]{margin-right:.278em}mjx-container [rspace="5"]{margin-right:.333em}mjx-container [size="s"]{font-size:70.7%}mjx-container [size=ss]{font-size:50%}mjx-container [size=Tn]{font-size:60%}mjx-container [size=sm]{font-size:85%}mjx-container [size=lg]{font-size:120%}mjx-container [size=Lg]{font-size:144%}mjx-container [size=LG]{font-size:173%}mjx-container [size=hg]{font-size:207%}mjx-container [size=HG]{font-size:249%}mjx-container [width=full]{width:100%}mjx-box{display:inline-block}mjx-block{display:block}mjx-itable{display:inline-table}mjx-row{display:table-row}mjx-row>*{display:table-cell}mjx-mtext{display:inline-block}mjx-mstyle{display:inline-block}mjx-merror{display:inline-block;color:red;background-color:#ff0}mjx-mphantom{visibility:hidden}mjx-assistive-mml{top:0;left:0;clip:rect(1px,1px,1px,1px);user-select:none;position:absolute!important;padding:1px 0 0!important;border:0!important;display:block!important;width:auto!important;overflow:hidden!important}mjx-assistive-mml[display=block]{width:100%!important}mjx-math{display:inline-block;text-align:left;line-height:0;text-indent:0;font-style:normal;font-weight:400;font-size:100%;letter-spacing:normal;border-collapse:collapse;overflow-wrap:normal;word-spacing:normal;white-space:nowrap;direction:ltr;padding:1px 0}mjx-container[jax=CHTML][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=CHTML][display=true][width=full]{display:flex}mjx-container[jax=CHTML][display=true] mjx-math{padding:0}mjx-container[jax=CHTML][justify=left]{text-align:left}mjx-container[jax=CHTML][justify=right]{text-align:right}mjx-mi{display:inline-block;text-align:left}mjx-c{display:inline-block}mjx-utext{display:inline-block;padding:.75em 0 .2em}mjx-mo{display:inline-block;text-align:left}mjx-stretchy-h{display:inline-table;width:100%}mjx-stretchy-h>*{display:table-cell;width:0}mjx-stretchy-h>*>mjx-c{display:inline-block;transform:scaleX(1)}mjx-stretchy-h>*>mjx-c::before{display:inline-block;width:initial}mjx-stretchy-h>mjx-ext{overflow:clip visible;width:100%}mjx-stretchy-h>mjx-ext>mjx-c::before{transform:scaleX(500)}mjx-stretchy-h>mjx-ext>mjx-c{width:0}mjx-stretchy-h>mjx-beg>mjx-c{margin-right:-.1em}mjx-stretchy-h>mjx-end>mjx-c{margin-left:-.1em}mjx-stretchy-v{display:inline-block}mjx-stretchy-v>*{display:block}mjx-stretchy-v>mjx-beg{height:0}mjx-stretchy-v>mjx-end>mjx-c{display:block}mjx-stretchy-v>*>mjx-c{transform:scaleY(1);transform-origin:left center;overflow:hidden}mjx-stretchy-v>mjx-ext{display:block;height:100%;box-sizing:border-box;border:0 solid transparent;overflow:visible clip}mjx-stretchy-v>mjx-ext>mjx-c::before{width:initial;box-sizing:border-box}mjx-stretchy-v>mjx-ext>mjx-c{transform:scaleY(500) translateY(.075em);overflow:visible}mjx-mark{display:inline-block;height:0}mjx-texatom{display:inline-block;text-align:left}mjx-munder{display:inline-block;text-align:left}mjx-over{text-align:left}mjx-munder:not([limits=false]){display:inline-table}mjx-munder>mjx-row{text-align:left}mjx-under{padding-bottom:.1em}mjx-mn{display:inline-block;text-align:left}mjx-mfrac{display:inline-block;text-align:left}mjx-frac{display:inline-block;vertical-align:.17em;padding:0 .22em}mjx-frac[type="d"]{vertical-align:.04em}mjx-frac[delims]{padding:0 .1em}mjx-frac[atop]{padding:0 .12em}mjx-frac[atop][delims]{padding:0}mjx-dtable{display:inline-table;width:100%}mjx-dtable>*{font-size:2000%}mjx-dbox{display:block;font-size:5%}mjx-num{display:block;text-align:center}mjx-den{display:block;text-align:center}mjx-mfrac[bevelled]>mjx-num{display:inline-block}mjx-mfrac[bevelled]>mjx-den{display:inline-block}mjx-den[align=right],mjx-num[align=right]{text-align:right}mjx-den[align=left],mjx-num[align=left]{text-align:left}mjx-nstrut{display:inline-block;height:.054em;width:0;vertical-align:-.054em}mjx-nstrut[type="d"]{height:.217em;vertical-align:-.217em}mjx-dstrut{display:inline-block;height:.505em;width:0}mjx-dstrut[type="d"]{height:.726em}mjx-line{display:block;box-sizing:border-box;min-height:1px;height:.06em;border-top:.06em solid;margin:.06em -.1em;overflow:hidden}mjx-line[type="d"]{margin:.18em -.1em}mjx-mrow{display:inline-block;text-align:left}mjx-msup{display:inline-block;text-align:left}mjx-c::before{display:block;width:0}.MJX-TEX{font-family:MJXZERO,MJXTEX}.TEX-B{font-family:MJXZERO,MJXTEX-B}.TEX-I{font-family:MJXZERO,MJXTEX-I}.TEX-MI{font-family:MJXZERO,MJXTEX-MI}.TEX-BI{font-family:MJXZERO,MJXTEX-BI}.TEX-S1{font-family:MJXZERO,MJXTEX-S1}.TEX-S2{font-family:MJXZERO,MJXTEX-S2}.TEX-S3{font-family:MJXZERO,MJXTEX-S3}.TEX-S4{font-family:MJXZERO,MJXTEX-S4}.TEX-A{font-family:MJXZERO,MJXTEX-A}.TEX-C{font-family:MJXZERO,MJXTEX-C}.TEX-CB{font-family:MJXZERO,MJXTEX-CB}.TEX-FR{font-family:MJXZERO,MJXTEX-FR}.TEX-FRB{font-family:MJXZERO,MJXTEX-FRB}.TEX-SS{font-family:MJXZERO,MJXTEX-SS}.TEX-SSB{font-family:MJXZERO,MJXTEX-SSB}.TEX-SSI{font-family:MJXZERO,MJXTEX-SSI}.TEX-SC{font-family:MJXZERO,MJXTEX-SC}.TEX-T{font-family:MJXZERO,MJXTEX-T}.TEX-V{font-family:MJXZERO,MJXTEX-V}.TEX-VB{font-family:MJXZERO,MJXTEX-VB}mjx-stretchy-h mjx-c,mjx-stretchy-v mjx-c{font-family:MJXZERO,MJXTEX-S1,MJXTEX-S4,MJXTEX,MJXTEX-A!important}@font-face{font-family:MJXZERO;src:url("lib/fonts/mathjax_zero.woff") format("woff")}@font-face{font-family:MJXTEX;src:url("lib/fonts/mathjax_main-regular.woff") format("woff")}@font-face{font-family:MJXTEX-B;src:url("lib/fonts/mathjax_main-bold.woff") format("woff")}@font-face{font-family:MJXTEX-I;src:url("lib/fonts/mathjax_math-italic.woff") format("woff")}@font-face{font-family:MJXTEX-MI;src:url("lib/fonts/mathjax_main-italic.woff") format("woff")}@font-face{font-family:MJXTEX-BI;src:url("lib/fonts/mathjax_math-bolditalic.woff") format("woff")}@font-face{font-family:MJXTEX-S1;src:url("lib/fonts/mathjax_size1-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S2;src:url("lib/fonts/mathjax_size2-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S3;src:url("lib/fonts/mathjax_size3-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S4;src:url("lib/fonts/mathjax_size4-regular.woff") format("woff")}@font-face{font-family:MJXTEX-A;src:url("lib/fonts/mathjax_ams-regular.woff") format("woff")}@font-face{font-family:MJXTEX-C;src:url("lib/fonts/mathjax_calligraphic-regular.woff") format("woff")}@font-face{font-family:MJXTEX-CB;src:url("lib/fonts/mathjax_calligraphic-bold.woff") format("woff")}@font-face{font-family:MJXTEX-FR;src:url("lib/fonts/mathjax_fraktur-regular.woff") format("woff")}@font-face{font-family:MJXTEX-FRB;src:url("lib/fonts/mathjax_fraktur-bold.woff") format("woff")}@font-face{font-family:MJXTEX-SS;src:url("lib/fonts/mathjax_sansserif-regular.woff") format("woff")}@font-face{font-family:MJXTEX-SSB;src:url("lib/fonts/mathjax_sansserif-bold.woff") format("woff")}@font-face{font-family:MJXTEX-SSI;src:url("lib/fonts/mathjax_sansserif-italic.woff") format("woff")}@font-face{font-family:MJXTEX-SC;src:url("lib/fonts/mathjax_script-regular.woff") format("woff")}@font-face{font-family:MJXTEX-T;src:url("lib/fonts/mathjax_typewriter-regular.woff") format("woff")}@font-face{font-family:MJXTEX-V;src:url("lib/fonts/mathjax_vector-regular.woff") format("woff")}@font-face{font-family:MJXTEX-VB;src:url("lib/fonts/mathjax_vector-bold.woff") format("woff")}mjx-c.mjx-c1D45B.TEX-I::before{padding:.442em .6em .011em 0;content:"n"}mjx-c.mjx-c2192::before{padding:.511em 1em .011em 0;content:"→"}mjx-c.mjx-c221E::before{padding:.442em 1em .011em 0;content:"∞"}mjx-c.mjx-c6C::before{padding:.694em .278em 0 0;content:"l"}mjx-c.mjx-c69::before{padding:.669em .278em 0 0;content:"i"}mjx-c.mjx-c6D::before{padding:.442em .833em 0 0;content:"m"}mjx-c.mjx-c1D44E.TEX-I::before{padding:.441em .529em .01em 0;content:"a"}mjx-c.mjx-c2B::before{padding:.583em .778em .082em 0;content:"+"}mjx-c.mjx-c28::before{padding:.75em .389em .25em 0;content:"("}mjx-c.mjx-c31::before{padding:.666em .5em 0 0;content:"1"}mjx-c.mjx-c29::before{padding:.75em .389em .25em 0;content:")"}mjx-c.mjx-c2E::before{padding:.12em .278em 0 0;content:"."}mjx-c.mjx-c3D::before{padding:.583em .778em .082em 0;content:"="}mjx-c.mjx-c5B::before{padding:.75em .278em .25em 0;content:"["}mjx-c.mjx-c5D::before{padding:.75em .278em .25em 0;content:"]"}mjx-c.mjx-cD7::before{padding:.491em .778em 0 0;content:"×"}mjx-c.mjx-c32::before{padding:.666em .5em 0 0;content:"2"}mjx-c.mjx-c34::before{padding:.677em .5em 0 0;content:"4"}mjx-c.mjx-c38::before{padding:.666em .5em .022em 0;content:"8"}mjx-c.mjx-c2026::before{padding:.12em 1.172em 0 0;content:"…"}mjx-c.mjx-c1D465.TEX-I::before{padding:.442em .572em .011em 0;content:"x"}mjx-c.mjx-c2212::before{padding:.583em .778em .082em 0;content:"−"}</style><pre class="frontmatter language-yaml" tabindex="0" style="display: none;"><code class="language-yaml is-loaded"><span class="token key atrule">week</span><span class="token punctuation">:</span> 第二周
<span class="token key atrule">dg-publish</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="Lecture 03 Database Storage Part 1"><p dir="auto">Lecture 03 Database Storage Part 1</p></h1><div class="el-p"><embed src="lib/media/03-storage1.pdf" style="width: 100%; max-width: 100%; height: 800px;"></div><div class="el-h3 heading-wrapper"><h3 data-heading="Overview" dir="auto" class="heading" id="Overview"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Overview</h3><div class="heading-children"><div class="el-p"><p dir="auto"><span alt="Pasted image 20250122091100.png" src="Pasted image 20250122091100.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250122091100.png" src="lib/media/pasted-image-20250122091100.png"></span><br>
不同层次将为数据库提供不同的功能和能力  公开一个API供上层组件使用<br>
you're going to issue a SQL query and that's going to first show up and get parased, this the string of text of the SQL query gets parsed, you'll run through the query Optimizer below then we'll start executing whatever the query plan is. there'll be access methods that actually talk to the tables or indexes or whatever we're tring to access be a buffalo manager to manage the memory for our database system and then the lowest level will be a disk manager.<br>
从application看起， 发出一个sql查询 首先会被显示并解析 （SQL查询文本字符串被解析） 我们将逐一介绍查询优化器 再次之下开始执行查询计划的内容   将会有访问方法来实际与table 和index 进行对话<br>
然后存在一个缓冲池管理器来管理我们数据库系统的内存<br>
在最底层 存在一个磁盘管理器负责数据的读写操作</p></div><div class="el-p"><p dir="auto">我们假设的是构建一种 被称为基于磁盘的 数据库系统 或面向磁盘的架构<br>
也就是说数据库管理系统会假设数据库的主要存储位置位于非易失性磁盘上 maybe a SSD or a spinning disk hard drive.<br>
所以本质上我们要解决协调和编排数据在磁盘和内存之间的来回传输</p></div><div class="el-h4 heading-wrapper"><h4 data-heading="Storage hierarchy" dir="auto" class="heading" id="Storage_hierarchy"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Storage hierarchy</h4><div class="heading-children"><div class="el-p"><p dir="auto"><span alt="Pasted image 20250122092302.png" src="Pasted image 20250122092302.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250122092302.png" src="lib/media/pasted-image-20250122092302.png"></span><br>
the only thing we care is the volatile and the non-volatile(易失性和非易失性)<br>
in non-volatile, we can only fetching blocks, but the volatile considered to be byte addressable.<br>
in non-volatile,we can only feching bolocks and bring that into memory and then do whatever you need.<br>
易失性存储被视为是按字节寻址  但是 非易失性存储 只能将block放入内存 然后进行操作</p></div><div class="el-p"><p dir="auto">SDD - 固态硬盘<br>
HDD - 传统硬盘</p></div><div class="el-p"><p dir="auto">we will chooose that'll maximize sequential access(最大化访问),   ----其实就是用连续空间存<br>
<span alt="Pasted image 20250122093413.png" src="Pasted image 20250122093413.png" class="internal-embed media-embed image-embed is-loaded" style="width: 500px; max-width: 100%;"><img alt="Pasted image 20250122093413.png" src="lib/media/pasted-image-20250122093413.png" style="width: 500px; max-width: 100%;"></span></p></div><div class="el-p"><p dir="auto">and something new<br>
<span alt="Pasted image 20250122093602.png" src="Pasted image 20250122093602.png" class="internal-embed media-embed image-embed is-loaded" style="width: 500px; max-width: 100%;"><img alt="Pasted image 20250122093602.png" src="lib/media/pasted-image-20250122093602.png" style="width: 500px; max-width: 100%;"></span><br>
Intel Optane 傲腾    ---  persistent memory  持久内存<br>
这个东西可能会改变游戏规则  但是  Intel 新ceo cut it   因为 无法获利<br>
<span alt="Pasted image 20250202154441.png" src="Pasted image 20250202154441.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250202154441.png" src="lib/media/pasted-image-20250202154441.png"></span></p></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="sequential vs  random access" dir="auto" class="heading" id="sequential_vs__random_access"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>sequential vs  random access</h4><div class="heading-children"><div class="el-p"><p dir="auto">database system is going to prefer sequential access over random access.<br>
即使是在SSD上，由于其内部工作原理设计专用集成电路（ASICs） 以及数据压缩等操作 顺序批量读写仍然被认为是高效的做法</p></div><div class="el-p"><p dir="auto">so the other system of design goals we're going to have and how we choose how we want to build our system uh is that we want to give the illusion that we're operating with the database entirely in memory. 我们关于系统设计的目标是我们希望营造一种假象—— 正在完全使用内存的方式操作数据库</p></div><div class="el-p"><p dir="auto">it's look like virtual memory<br>
so we don't want to do virtual memory for the OS</p></div><div class="el-p"><p dir="auto">我们在Disk上有一些数据库文件----分成好多pages 还有 目录Directory--说明我有哪些页面--通过偏移量可以找到他们<br>
we have some buffer pool ----  缓冲池----其中的内存 数据系统分配基本上成为malloc<br>
there'll be some buffer pool where of memory the data system allocated basically called malloc against the OS got some memory and then we're use that as the staging area where we bring pages in from disk. so now I have the execution engine(执行引擎). the thing that's going to run our query it comes along.<br>
and It wants to get page number two,</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">the first thing we're got to do is bring in the page directory because that's going to tell us where you know where on disk or the pages are.</li>
<li data-line="1" dir="auto">and then it'll make a call to the OS or whatever the divice it that's storing the database file and it'll bring that page into memory</li>
<li data-line="2" dir="auto">then the buffer pool will give back the execution engine a pointer in memory a 64-bit pointer in memory of where this page exists.</li>
<li data-line="3" dir="auto">and then the execution engine or the access method the operators to then interpret what's inside that page</li>
<li data-line="4" dir="auto">and then update</li>
<li data-line="5" dir="auto">then back to disk<br>
<span alt="Pasted image 20250122100248.png" src="Pasted image 20250122100248.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250122100248.png" src="lib/media/pasted-image-20250122100248.png"></span></li>
</ul></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="so why not use the OS?" dir="auto" class="heading" id="so_why_not_use_the_OS?"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>so why not use the OS?</h4><div class="heading-children"><div class="el-p"><p dir="auto">the database system can use <strong>memory mapping(mmap)</strong> take the contens of a file that's on disk and you map it into virtual memory in your process 使得可以将磁盘中的文件内容映射到进程的虚拟内存中 即进程的地址空间内<br>
and then that process can jump to any offset in that address space in memory  然后可以跳转到内存中改地址空间的任意偏移量处<br>
and the OS is responsible for deciding  is the thing you need in memory or not. if not, then it goes and fetches the page you need and brings it a memory.<br>
so the database can't do any of the writes it just map opens the file and the OS does all the management of the data moving the data back and forth for us<br>
look like this.<br>
<span alt="Pasted image 20250122101225.png" src="Pasted image 20250122101225.png" class="internal-embed media-embed image-embed is-loaded" style="width: 400px; max-width: 100%;"><img alt="Pasted image 20250122101225.png" src="lib/media/pasted-image-20250122101225.png" style="width: 400px; max-width: 100%;"></span><br>
如果我的进程想要访问第一页 我们会遇到页面错误  因为操作系统发现在物理内存中没有找到第一页 然后操作系统会访问磁盘 为我检索数据 将其放入内存  并更新虚拟内存以指向该数据<br>
<span alt="Pasted image 20250122101331.png" src="Pasted image 20250122101331.png" class="internal-embed media-embed image-embed is-loaded" style="width: 400px; max-width: 100%;"><img alt="Pasted image 20250122101331.png" src="lib/media/pasted-image-20250122101331.png" style="width: 400px; max-width: 100%;"></span><br>
如果想访问page2 -》  my process stalls -- 进程停滞 -- 操作系统发生阻塞 提示 没有更多的物理内存了<br>
but the OS is goint to have its own internal statistics about how these pages are beging accessed. the OS can make a decisoin about what page to evict. -- 问题是操作系统会拥有关于这些页面如果被访问的内部统计数据 并根据数据作出决定  选择那个页面进行置换<br>
but it donesn't know anything about what we're doing inside the database system because it just seeds reads and writes. it doesn't know what's in these data pages, what's in these files.<br>
so the evict, if we rely on the OS, we will face multiple problems.   但它对数据库内部的操作一无所知，因为它仅涉及读取和写入操作  它并不知道查询是什么 不清楚数据页中包含什么内容 也不知道文件中有什么<br>
简单来说就是操作系统并不了解数据库系统内部正在进行的操作；它只知道有读和写的请求发生，但不了解这些数据页面或文件的内容及其重要性。<br>
而这只是一个线程  如果一个线程操作完了 但是另一个线程还想读取这个page  但可能会被驱逐 --我们对操作系统的内部一无所知</p></div><div class="el-p"><p dir="auto">如果只读的话 没啥事儿   所以确实一些数据库系统 在系统的只读部分使用了MMAP技术</p></div><div class="el-p"><p dir="auto">other problems:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">OS can flush dirty pages at any time.<br>
if I have multiple page I need to make sure that these pages are actually written out in the right order and the OS doesn't know. it just solves sees dirty Pages. it doesn't know anything about this page need to be written before.<br>
example if you can lock the page using M lock, but that only prevents the OS from swapping it out doesn't prevent it from writing out, so now it may write out a dirty page.<br>
M-lock 并不会阻止操作系统将脏页写回到磁盘。也就是说，虽然你锁定了页面不让它被换出，但如果你对页面做了修改（使之成为脏页），操作系统仍然可以在任何时间点决定将这些修改后的数据写回到磁盘<br>
脏页就是 更改后未更新到disk中的page<br>
数据写入磁盘的顺序可能至关重要。例如，在事务处理中，必须确保按照一定的顺序提交数据以维护数据一致性。由于操作系统并不了解这种逻辑依赖关系，它可能会根据自己的调度策略异步地写回脏页，这可能导致不期望的数据写入顺序。</li>
<li data-line="6" dir="auto">DBMS doesn't know which pages are in memory. The OS will stall a thread on page fault.</li>
<li data-line="7" dir="auto">没法获得错误代码  只能取回中断</li>
</ol></div><div class="el-p"><p dir="auto">有好多系统曾经用过mmap 后来摆脱<br>
<span alt="Pasted image 20250202163105.png" src="Pasted image 20250202163105.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250202163105.png" src="lib/media/pasted-image-20250202163105.png"></span><br>
顶部的是 完全采用mmap的  下面的是部分采用的  而且有的已经摆脱了<br>
若采用mmap  可以迅速搭建起运行环境 无需自行构建缓冲池管理器 但是需要依赖操作系统来回移动数据  操作系统可能会做出糟糕的意想不到的决策</p></div><div class="el-p"><p dir="auto">the problem we need solve</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">How the database system represents the database in files on disk</li>
<li data-line="1" dir="auto">how the database system manages its memory and moves data back-and-forth from disk.</li>
</ul></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="Disk Layout" dir="auto" class="heading" id="Disk_Layout"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Disk Layout</h3><div class="heading-children"><div class="el-p"><p dir="auto">数据在磁盘页面上会呈现出三层结构</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">File Storage</li>
<li data-line="1" dir="auto">Page Layout</li>
<li data-line="2" dir="auto">Tuple Layout<br>
在文件内部 将会存在page   在page中我们会存在tuple（表中实际数据<br>
暂时先忽略索引 index</li>
</ul></div><div class="el-h4 heading-wrapper"><h4 data-heading="File Storage" dir="auto" class="heading" id="File_Storage"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>File Storage</h4><div class="heading-children"><div class="el-p"><p dir="auto">数据库系统维护一个数据库 作为磁盘上的一个额外文件<br>
SQLite  DuckDB 都是单文件数据库  Postgres MySQL 都是多文件数据库<br>
这些文件的格式 是特定的定制格式</p></div><div class="el-p"><p dir="auto">so the part of the database system is going to be responsible for maintaining and coordinating these different files is we'll call generically as the storage manager, sometimes it's called the storage engine.   数据库系统中负责维护和协调不同文件的部分  叫  存储管理器   存储引擎<br>
这是系统中与硬件或存储设备通信的组件  无论是引入操作系统还是直接访问   检索数据引入数据库系统的内存中   这些系统中都会维护自己的磁盘调度器或分派器 来决定按某种顺序读取哪些页面  因为我们想最小化 数据载入内存以及立即移出的频繁操作 下节课讲</p></div><div class="el-p"><p dir="auto">it organizes the file as a collection of pages, it track what data read or write to pages and track how much space is available in each of them.</p></div><div class="el-p"><p dir="auto">A DBMS typically does not . maintain multiple copies of a page on disk.</p></div><div class="el-p"><p dir="auto">what is the page?<br>
the page is a fixed-size block of data.<br>
→It can contain tuples, meta-data, indexes, log records…<br>
→Most systems do not mix page types.<br>
→Some systems require a page to be self-contained 意味着 所有该页面内部内容所需要的所有元数据 都应该包含在page中</p></div><div class="el-p"><p dir="auto">Each page is given a unique identifier---pageID<br>
→The DBMS uses an indirection layer to map page IDs to physical locations</p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250122105844.png" src="Pasted image 20250122105844.png" class="internal-embed media-embed image-embed is-loaded" style="width: 400px; max-width: 100%;"><img alt="Pasted image 20250122105844.png" src="lib/media/pasted-image-20250122105844.png" style="width: 400px; max-width: 100%;"></span><br>
<span alt="Pasted image 20250122105929.png" src="Pasted image 20250122105929.png" class="internal-embed media-embed image-embed is-loaded" style="width: 300px; max-width: 100%;"><img alt="Pasted image 20250122105929.png" src="lib/media/pasted-image-20250122105929.png" style="width: 300px; max-width: 100%;"></span><br>
或许越大越好  因为访存最大化  但越大 写入操作的性能或许也越差  这是需要权衡的一个点</p></div><div class="el-p"><p dir="auto">now we will talk about how do we actually keep track of that mapping of page IDs to locations.<br>
现在我们将讨论如何实际跟踪页面ID到位置的映射<br>
Different database systems manage pages in files on disk in different ways.<br>
<span alt="Pasted image 20250122190322.png" src="Pasted image 20250122190322.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250122190322.png" src="lib/media/pasted-image-20250122190322.png"></span><br>
heap file organization或许是最常见的一种方式<br>
tree file就是 存储在叶节点中 突然想到了merkle tree<br>
也可以使用hash table<br>
ISAM  顺序存储   MySQL曾经默认执行的一种操作<br>
日志结构的相关内容 下节课</p></div><div class="el-p"><p dir="auto">heap fine is an unordered collection of pages with tuples that are stored in random order.<br>
数据不必按照精确的顺序指定----但一些系统会进行预排序，来达到一个很好的效果<br>
API: create get write delete     iterating all the pages</p></div><div class="el-p"><p dir="auto">It is easy to find pages if there is only a single file, like SQLite ....<br>
we just know the page number and size<br>
<span alt="Pasted image 20250122191046.png" src="Pasted image 20250122191046.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250122191046.png" src="lib/media/pasted-image-20250122191046.png"></span><br>
在sqlite的源文档中，他们在他们的头文件header中，基本上跟踪了所有的元数据来实现这个技巧</p></div><div class="el-p"><p dir="auto">if we have many fils, such as postgres, mysql, oracle<br>
page directory<br>
通常是一个特殊文件   要么为了单个数据库文件的头部  要目位于数据库系统内部的某个特殊位置  可以形象的理解为database中的database<br>
<span alt="Pasted image 20250122193807.png" src="Pasted image 20250122193807.png" class="internal-embed media-embed image-embed is-loaded" style="width: 200px; max-width: 100%;"><img alt="Pasted image 20250122193807.png" src="lib/media/pasted-image-20250122193807.png" style="width: 200px; max-width: 100%;"></span><br>
除了物理位置 我们也可以跟踪一些其他额外的元数据   我们可以计入一些关键位置  空槽数量<br>
那么如果我想插入一个元组并且需要找到一个页面来放置它 我不想必须扫描所有页面并计算出那个页面有空闲 page directory会说明这些信息</p></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="page layout" dir="auto" class="heading" id="page_layout"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>page layout</h4><div class="heading-children"><div class="el-p"><p dir="auto">every page have header that is going to tell you something about what the data actually is so common thing would be like the page size or a checksum<br>
<span alt="" src="Pasted image 20250201175347.png" class="internal-embed media-embed image-embed is-loaded"><img src="lib/media/pasted-image-20250201175347.png"></span><br>
checksum：如果发生了崩溃 重启了系统 可以快速检查 以确保数据没有被损坏<br>
<span alt="Pasted image 20250201210737.png" src="Pasted image 20250201210737.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250201210737.png" src="lib/media/pasted-image-20250201210737.png"></span></p></div><div class="el-p"><p dir="auto">how to sotre tuples in a page?<br>
let's say we have a really simple approach where in our page header we just keep track of the number of tuples in a page and then just append a new tuple to the end.<br>
so we just go look at the header see the number tuples and multiply that by the size of the tuple that is where offset I want to write the page.<br>
but  it's a bad idea<br>
if we have to delete a tuple, then it just throws everything out of order.<br>
<span alt="Pasted image 20250201212627.png" src="Pasted image 20250201212627.png" class="internal-embed media-embed image-embed is-loaded" style="width: 200px; max-width: 100%;"><img alt="Pasted image 20250201212627.png" src="lib/media/pasted-image-20250201212627.png" style="width: 200px; max-width: 100%;"></span><br>
if I want to be able to do in insert a new tuple,  and we don't want to use the end, we want to use the spot here.<br>
<span alt="Pasted image 20250201221322.png" src="Pasted image 20250201221322.png" class="internal-embed media-embed image-embed is-loaded" style="width: 300px; max-width: 100%;"><img alt="Pasted image 20250201221322.png" src="lib/media/pasted-image-20250201221322.png" style="width: 300px; max-width: 100%;"></span><br>
but the tuple is not the fixed length, 这个地方可能放不进去<br>
我们需要额外的源数据来跟踪<br>
如果想把3往上移动 就要告诉系统其他部分 我移动了3这个位置</p></div><div class="el-p"><p dir="auto">so the most common layout scheme is called slotted pages(分槽页)<br>
并不是每一个系统都会这样做  但是大多数面向行的数据库系统基本上都会这么做<br>
首先有一个header跟踪数据（前面提到过）   在header 之后 有一个slot array, every position in that slot array is goint to point to some tuple in our page and the tuple begin at the bottom at the end of the page .  so in the page bottom we have the fixed length and var-length tuple data.<br>
the slot array storing fixed length offsets to where to find the starting location.<br>
<span alt="Pasted image 20250201213909.png" src="Pasted image 20250201213909.png" class="internal-embed media-embed image-embed is-loaded" style="width: 300px; max-width: 100%;"><img alt="Pasted image 20250201213909.png" src="lib/media/pasted-image-20250201213909.png" style="width: 300px; max-width: 100%;"></span><br>
if we want to add tuples, the slot array is going to grow from the begining to the end. and the tuple grow from the end to the beginning.<br>
什么是 page 已满，指的是数据占用了该 page 的一半以上的大小，再也无法存入任何信息了<br>
<span alt="Pasted image 20250201214220.png" src="Pasted image 20250201214220.png" class="internal-embed media-embed image-embed is-loaded" style="width: 300px; max-width: 100%;"><img alt="Pasted image 20250201214220.png" src="lib/media/pasted-image-20250201214220.png" style="width: 300px; max-width: 100%;"></span></p></div><div class="el-p"><p dir="auto">if we delete tuple three.<br>
slot4 还是指向这个地方 我不需要告诉系统的其他地方 移动了4<br>
<span alt="Pasted image 20250201215522.png" src="Pasted image 20250201215522.png" class="internal-embed media-embed image-embed is-loaded" style="width: 300px; max-width: 100%;"><img alt="Pasted image 20250201215522.png" src="lib/media/pasted-image-20250201215522.png" style="width: 300px; max-width: 100%;"></span><br>
如果我想移动4过去压缩空间  只需要更新slot array  指向新的偏移量<br>
<span alt="Pasted image 20250201215619.png" src="Pasted image 20250201215619.png" class="internal-embed media-embed image-embed is-loaded" style="width: 300px; max-width: 100%;"><img alt="Pasted image 20250201215619.png" src="lib/media/pasted-image-20250201215619.png" style="width: 300px; max-width: 100%;"></span></p></div><div class="el-p"><p dir="auto">postgres这么做  mysql不这么做  SQLserver这么做</p></div><div class="el-p"><p dir="auto">在加入tuple的时候 可能会重新启用slot array3的位置 但是4指向的偏移量不会变 -- 只需要在header里面记录号 tuple5用的slot array3就好了<br>
这样使用可能会浪费一部分空间，比如图中2和3之间有一小块就被浪费了 但是这种方式我们无需调整槽位数组顺序时更新别的内容  足够弥补</p></div><div class="el-p"><p dir="auto">一种方法来表示tuple —— record id<br>
不同的数据库可能叫行id 或者是 行号<br>
但是本质上这是一种根据logical tuple 在文件内部 页面内部的物理位置来唯一标识它的方法<br>
通常来说 这是一个 combination of a file number, id number, the page number and then the slot number that corresponds where they exist in that slot array.<br>
所以说如果想要查找 如果有记录id  那么就可以在页目录中找到拥有tuple的页，获取这一页后利用slot array找到该tuple的偏移量</p></div><div class="el-p"><p dir="auto">但大多数数据库在tuple 的数据中并没有存储这个id<br>
但是SQLite将此村委一个不应看到的独立列 但是可以访问 他们之所以这么做 是因为他们想以此作为主键 以便能够识别出各个tuple<br>
<span alt="Pasted image 20250201223159.png" src="Pasted image 20250201223159.png" class="internal-embed media-embed image-embed is-loaded" style="width: 200px; max-width: 100%;"><img alt="Pasted image 20250201223159.png" src="lib/media/pasted-image-20250201223159.png" style="width: 200px; max-width: 100%;"></span></p></div><div class="el-p"><p dir="auto">这都是slot number 就是槽号  不是tuple实际位置  因为是从第四个slot的地方 用指针去找tuple</p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250201223353.png" src="Pasted image 20250201223353.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250201223353.png" src="lib/media/pasted-image-20250201223353.png"></span><br>
在postgres中有一个ctid的概念<br>
ctid： 表示<strong>数据记录的物理行当信息</strong>，指的是 一条记录位于哪个数据块的哪个位移上面。<br>
<span alt="Pasted image 20250201223451.png" src="Pasted image 20250201223451.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250201223451.png" src="lib/media/pasted-image-20250201223451.png"></span><br>
如果我们删除101  我们发现并没有调整其他数据的位置<br>
<span alt="Pasted image 20250201223546.png" src="Pasted image 20250201223546.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250201223546.png" src="lib/media/pasted-image-20250201223546.png"></span><br>
添加后 也没有占用前面的空间<br>
如果启用垃圾回收  在postgres中叫做vacuum,将会压缩每一个页面 写出新的页面 新的文件<br>
<span alt="Pasted image 20250201223753.png" src="Pasted image 20250201223753.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250201223753.png" src="lib/media/pasted-image-20250201223753.png"></span></p></div><div class="el-p"><p dir="auto">在SQLite中 不会重用行id<br>
<span alt="Pasted image 20250201224436.png" src="Pasted image 20250201224436.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250201224436.png" src="lib/media/pasted-image-20250201224436.png"></span></p></div><div class="el-p"><p dir="auto">在SQL server中<br>
<span alt="Pasted image 20250201224624.png" src="Pasted image 20250201224624.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250201224624.png" src="lib/media/pasted-image-20250201224624.png"></span><br>
文件编号，页码，槽位编号<br>
<span alt="Pasted image 20250201224735.png" src="Pasted image 20250201224735.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250201224735.png" src="lib/media/pasted-image-20250201224735.png"></span><br>
没有移动<br>
<span alt="Pasted image 20250201224806.png" src="Pasted image 20250201224806.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250201224806.png" src="lib/media/pasted-image-20250201224806.png"></span><br>
插入新的数据之后 自动移动了<br>
之所以可以这么做 是因为在插入数据的时候  页面被带入内存<br>
当插入tuple的时候，我们持有该页面的锁 数据系统可以决定是否压缩空间 因为他知道没有其他线程可以同时写入该页面</p></div><div class="el-p"><p dir="auto">Oracle有rowID<br>
<span alt="Pasted image 20250201225152.png" src="Pasted image 20250201225152.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250201225152.png" src="lib/media/pasted-image-20250201225152.png"></span><br>
<span alt="Pasted image 20250201225238.png" src="Pasted image 20250201225238.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250201225238.png" src="lib/media/pasted-image-20250201225238.png"></span></p></div><div class="el-p"><p dir="auto"><strong>Postgres:</strong></p></div><div class="el-pre"><pre class="language-sql" tabindex="0"><code data-line="0" class="language-sql is-loaded"><span class="token comment">-- create</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> r <span class="token punctuation">(</span>
    id  <span class="token keyword">INTEGER</span><span class="token punctuation">,</span>
    val <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- insert</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> r <span class="token punctuation">(</span>id<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'aaa'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token string">'bbb'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span> <span class="token string">'ccc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- fetch </span>
<span class="token keyword">SELECT</span> r<span class="token punctuation">.</span>ctid<span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> r<span class="token punctuation">;</span>

<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> r <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">101</span><span class="token punctuation">;</span>
<span class="token comment">-- 再次查询时会看到 (0,1) 和 (0,3) 的 ctid</span>
<span class="token keyword">SELECT</span> r<span class="token punctuation">.</span>ctid<span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> r<span class="token punctuation">;</span>

VACUUM <span class="token keyword">FULL</span> r<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> r<span class="token punctuation">.</span>ctid<span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> r<span class="token punctuation">;</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250402211958.png" src="Pasted image 20250402211958.png" class="internal-embed media-embed image-embed is-loaded" style="width: 700px; max-width: 100%;"><img alt="Pasted image 20250402211958.png" src="lib/media/pasted-image-20250402211958.png" style="width: 700px; max-width: 100%;"></span></p></div><div class="el-p"><p dir="auto"><strong>SQLite</strong></p></div><div class="el-pre"><pre class="language-sql" tabindex="0"><code data-line="0" class="language-sql is-loaded"><span class="token comment">-- create</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> r <span class="token punctuation">(</span>
    id  <span class="token keyword">INTEGER</span><span class="token punctuation">,</span>
    val <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- insert</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> r <span class="token punctuation">(</span>id<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'aaa'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token string">'bbb'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span> <span class="token string">'ccc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- fetch </span>
<span class="token keyword">SELECT</span> rowID<span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> r<span class="token punctuation">;</span>

<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> r <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">101</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> rowID<span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> r<span class="token punctuation">;</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250402212315.png" src="Pasted image 20250402212315.png" class="internal-embed media-embed image-embed is-loaded" style="width: 700px; max-width: 100%;"><img alt="Pasted image 20250402212315.png" src="lib/media/pasted-image-20250402212315.png" style="width: 700px; max-width: 100%;"></span></p></div><div class="el-p"><p dir="auto"><strong>SQL Server</strong></p></div><div class="el-pre"><pre class="language-sql" tabindex="0"><code data-line="0" class="language-sql is-loaded"><span class="token comment">-- create</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> r <span class="token punctuation">(</span>
    id  <span class="token keyword">INTEGER</span><span class="token punctuation">,</span>
    val <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- insert</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> r <span class="token punctuation">(</span>id<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'aaa'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token string">'bbb'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span> <span class="token string">'ccc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- fetch </span>
<span class="token keyword">SELECT</span> 
    sys<span class="token punctuation">.</span>fn_PhysLocFormatter<span class="token punctuation">(</span><span class="token operator">%</span><span class="token operator">%</span>physloc<span class="token operator">%</span><span class="token operator">%</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token punctuation">[</span><span class="token keyword">File</span>:Page:Slot<span class="token punctuation">]</span><span class="token punctuation">,</span>r<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">FROM</span> r<span class="token punctuation">;</span>

<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> r <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">101</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> 
    sys<span class="token punctuation">.</span>fn_PhysLocFormatter<span class="token punctuation">(</span><span class="token operator">%</span><span class="token operator">%</span>physloc<span class="token operator">%</span><span class="token operator">%</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token punctuation">[</span><span class="token keyword">File</span>:Page:Slot<span class="token punctuation">]</span><span class="token punctuation">,</span>r<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">FROM</span> r<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> r <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">,</span><span class="token string">'xxx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> 
    sys<span class="token punctuation">.</span>fn_PhysLocFormatter<span class="token punctuation">(</span><span class="token operator">%</span><span class="token operator">%</span>physloc<span class="token operator">%</span><span class="token operator">%</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token punctuation">[</span><span class="token keyword">File</span>:Page:Slot<span class="token punctuation">]</span><span class="token punctuation">,</span>r<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">FROM</span> r<span class="token punctuation">;</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250402213549.png" src="Pasted image 20250402213549.png" class="internal-embed media-embed image-embed is-loaded" style="width: 700px; max-width: 100%;"><img alt="Pasted image 20250402213549.png" src="lib/media/pasted-image-20250402213549.png" style="width: 700px; max-width: 100%;"></span></p></div><div class="el-p"><p dir="auto">Oracle<br>
Oracle 的&nbsp;<code>ROWID</code>&nbsp;是 18 位字符，格式为：</p></div><div class="el-pre"><pre><code data-line="0">OOOOOOFFFBBBBBBRRR
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">​<strong>OOOOOO</strong>：数据对象号（Data Object Number）</li>
<li data-line="1" dir="auto">​<strong>FFF</strong>：文件号（File ID）</li>
<li data-line="2" dir="auto">​<strong>BBBBBB</strong>：块号（Block Number）</li>
<li data-line="3" dir="auto">​<strong>RRR</strong>：行号（Row Number，即块内偏移量，从 0 开始）</li>
</ul></div><div class="el-pre"><pre class="language-sql" tabindex="0"><code data-line="0" class="language-sql is-loaded"><span class="token comment">-- create</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> r <span class="token punctuation">(</span>
    id  <span class="token keyword">INTEGER</span><span class="token punctuation">,</span>
    val <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- insert</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> r <span class="token punctuation">(</span>id<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'aaa'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token string">'bbb'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span> <span class="token string">'ccc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- fetch </span>
<span class="token keyword">SELECT</span> rowid<span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> r<span class="token punctuation">;</span>

<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> r <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">101</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> rowid<span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> r<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> r <span class="token punctuation">(</span>id<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">,</span><span class="token string">'zzz'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> rowid<span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> r<span class="token punctuation">;</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250402214509.png" src="Pasted image 20250402214509.png" class="internal-embed media-embed image-embed is-loaded" style="width: 700px; max-width: 100%;"><img alt="Pasted image 20250402214509.png" src="lib/media/pasted-image-20250402214509.png" style="width: 700px; max-width: 100%;"></span></p></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="tuple layout" dir="auto" class="heading" id="tuple_layout"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>tuple layout</h4><div class="heading-children"><div class="el-p"><p dir="auto">tuple 本身只是一串字节序列<br>
database system to know how to interpret those bytes based on the type and based on the values that you're looking at.</p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250202145811.png" src="Pasted image 20250202145811.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250202145811.png" src="lib/media/pasted-image-20250202145811.png"></span></p></div><div class="el-p"><p dir="auto">tuple 有一个 header  存储自己本身的一些元数据<br>
因此会有可见性信息  --  比如这个元组是否被删除<br>
用bitmap（位图）表示null   后面会讲</p></div><div class="el-p"><p dir="auto">Attributes are typically stored in the order that you specify them when you create the table.<br>
<span alt="Pasted image 20250202150450.png" src="Pasted image 20250202150450.png" class="internal-embed media-embed image-embed is-loaded" style="width: 300px; max-width: 100%;"><img alt="Pasted image 20250202150450.png" src="lib/media/pasted-image-20250202150450.png" style="width: 300px; max-width: 100%;"></span><br>
这样做是出于software engineering reasons（软件工程原因）  --  simplicity  更简单<br>
但是，以不同的方式布局它们可能更有效<br>
如果我有两个表 其中一个表中有外键引用另一个表<br>
<span alt="Pasted image 20250202150731.png" src="Pasted image 20250202150731.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250202150731.png" src="lib/media/pasted-image-20250202150731.png"></span><br>
查询的时候可能需要连表</p></div><div class="el-pre"><pre class="language-sql" tabindex="0"><code data-line="0" class="language-sql is-loaded"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> foo <span class="token keyword">JOIN</span> bar <span class="token keyword">ON</span> foo<span class="token punctuation">.</span>a <span class="token operator">=</span> bar<span class="token punctuation">.</span>a<span class="token punctuation">;</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">我可以存储为单独的页面<br>
<span alt="Pasted image 20250202150819.png" src="Pasted image 20250202150819.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250202150819.png" src="lib/media/pasted-image-20250202150819.png"></span><br>
但是有些系统将相关表的元组嵌入在 原始的基本元组中<br>
<span alt="Pasted image 20250202150858.png" src="Pasted image 20250202150858.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250202150858.png" src="lib/media/pasted-image-20250202150858.png"></span><br>
在应用程序中  它仍然看起来是两个单独的表  但在幕后  我可以嵌入他们可以使事情更快<br>
但是这样对应的更新也会more expensive  性能更差</p></div><div class="el-p"><embed src="lib/media/03-storage1-node.pdf" style="width: 100%; max-width: 100%; height: 800px;"></div><div class="mod-footer mod-ui"></div></div></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>