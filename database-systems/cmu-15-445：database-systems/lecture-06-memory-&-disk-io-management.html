<!DOCTYPE html> <html><head>
		<title>Lecture 06 Memory &amp; Disk IO Management</title>
		<base href="..\../">
		<meta id="root-path" root-path="..\../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="QingZhiLiangCheng - Lecture 06 Memory &amp; Disk IO Management">
		<meta property="og:title" content="Lecture 06 Memory &amp; Disk IO Management">
		<meta property="og:description" content="QingZhiLiangCheng - Lecture 06 Memory &amp; Disk IO Management">
		<meta property="og:type" content="website">
		<meta property="og:url" content="https://qingzhiliangcheng.cn/database-systems/cmu-15-445：database-systems/lecture-06-memory-&amp;-disk-io-management.html">
		<meta property="og:image" content="https://qingzhiliangcheng.cn/lib/media/pasted-image-20250207180213.png">
		<meta property="og:site_name" content="QingZhiLiangCheng">
		<meta name="author" content="QingZhiLiangCheng"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.png"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="preload" href="lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/other-plugins.css"></noscript><link rel="stylesheet" href="lib/styles/theme.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/supported-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/supported-plugins.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript><link rel="preload" href="lib/styles/snippets.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/snippets.css"></noscript></head><body class="publish css-settings-manager theme-light show-inline-title show-ribbon mk-readable-line mk-folder-lines mk-spaces-enabled mk-inline-context-enabled mk-flow-minimal background-settings-workplace-theme-light-custom-option background-settings-workplace-theme-dark-in-the-sky background-image-settings-switch toggle-nonoverlapping-bg background-image-settings-markdown-page-custom notebook-liked-markdown-page-grid-notebook-2 background-image-settings-command-palette-switch background-image-settings-command-palette-same-as-workplace toggle-bg-panel-page panel-page-bg-theme-light-wall panel-page-bg-theme-dark-plant layout-style-options-default clutter-free-headings bt-default-unordered-list default-ol-list-marker list-no-border bt-connected-indent-hover bt-colorful-connected-indent-hover folder-icons remove-arrow bt-toggle-colorful-folder folder-style-change-options-colorful-border folder-colorful-six table-width-100 tag-default admonition-bg-color-same style-options-for-admonition-plugin style-options-for-buttons-plugin dataview-list-style-pacman memos-banner-gradient thino-frosted-style thino-background-default quiet-outline-optimize code-theme-custom code-line-number whole-code-wrap"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles">mjx-c.mjx-c1D43E.TEX-I::before{padding:.683em .889em 0 0;content:"K"}mjx-c.mjx-c1D44A.TEX-I::before{padding:.683em 1.048em .022em 0;content:"W"}mjx-c.mjx-c1D70F.TEX-I::before{padding:.431em .517em .013em 0;content:"τ"}mjx-c.mjx-c394::before{padding:.716em .833em 0 0;content:"Δ"}mjx-c.mjx-c1D446.TEX-I::before{padding:.705em .645em .022em 0;content:"S"}mjx-c.mjx-c1D450.TEX-I::before{padding:.442em .433em .011em 0;content:"c"}mjx-c.mjx-c25::before{padding:.75em .833em .056em 0;content:"%"}mjx-c.mjx-cB7::before{padding:.31em .278em 0 0;content:"⋅"}.mjx-stretched mjx-c.mjx-c2013::before{content:"–"}mjx-stretchy-h.mjx-c2013 mjx-ext mjx-c::before{content:"–";padding:.285em 0 0}mjx-c.mjx-c24::before{padding:.75em .5em .056em 0;content:"$"}mjx-c.mjx-c1D45D.TEX-I::before{padding:.442em .503em .194em 0;content:"p"}mjx-c.mjx-c39::before{padding:.666em .5em .022em 0;content:"9"}mjx-stretchy-v.mjx-c7B mjx-beg mjx-c::before{content:"⎧";padding:.899em .889em .01em 0}mjx-stretchy-v.mjx-c7B mjx-ext mjx-c::before{content:"⎪";width:.889em}mjx-stretchy-v.mjx-c7B mjx-end mjx-c::before{content:"⎩";padding:.01em .889em .899em 0}mjx-stretchy-v.mjx-c7B mjx-mid mjx-c::before{content:"⎨";padding:1.16em .889em .66em 0}mjx-stretchy-v.mjx-c7B>mjx-mid{margin-top:-.91em;margin-bottom:-.91em}mjx-stretchy-v.mjx-c7B>mjx-end{margin-top:-.909em}mjx-stretchy-v.mjx-c7B>mjx-ext{height:50%;border-top-width:.879em;border-bottom-width:.879em}mjx-c.mjx-c1D463.TEX-I::before{padding:.443em .485em .011em 0;content:"v"}mjx-c.mjx-c1D443.TEX-I::before{padding:.683em .751em 0 0;content:"P"}mjx-c.mjx-c1D448.TEX-I::before{padding:.683em .767em .022em 0;content:"U"}mjx-c.mjx-c1D447.TEX-I::before{padding:.677em .704em 0 0;content:"T"}mjx-c.mjx-c2032::before{padding:.56em .275em 0 0;content:"′"}mjx-c.mjx-c22C5::before{padding:.31em .278em 0 0;content:"⋅"}mjx-c.mjx-c20D7.TEX-V::before{padding:.714em .5em 0 0;content:"→"}mjx-c.mjx-c1D435.TEX-I::before{padding:.683em .759em 0 0;content:"B"}mjx-c.mjx-c1D458.TEX-I::before{padding:.694em .521em .011em 0;content:"k"}mjx-c.mjx-c1D439.TEX-I::before{padding:.68em .749em 0 0;content:"F"}mjx-c.mjx-c3A::before{padding:.43em .278em 0 0;content:":"}mjx-c.mjx-c2033::before{padding:.56em .55em 0 0;content:"′′"}mjx-c.mjx-cAC::before{padding:.356em .667em 0 0;content:"¬"}mjx-c.mjx-c2227::before{padding:.598em .667em .022em 0;content:"∧"}mjx-c.mjx-c2228::before{padding:.598em .667em .022em 0;content:"∨"}mjx-c.mjx-c2295::before{padding:.583em .778em .083em 0;content:"⊕"}mjx-munderover{display:inline-block;text-align:left}mjx-munderover:not([limits=false]){padding-top:.1em}mjx-munderover:not([limits=false])>*{display:block}mjx-msubsup{display:inline-block;text-align:left}mjx-script{display:inline-block;padding-right:.05em;padding-left:.033em}mjx-script>mjx-spacer{display:block}mjx-mover{display:inline-block;text-align:left}mjx-mover:not([limits=false]){padding-top:.1em}mjx-mover:not([limits=false])>*{display:block;text-align:left}mjx-c.mjx-c1D449.TEX-I::before{padding:.683em .769em .022em 0;content:"V"}mjx-c.mjx-c1D466.TEX-I::before{padding:.442em .49em .205em 0;content:"y"}mjx-c.mjx-c1D451.TEX-I::before{padding:.694em .52em .01em 0;content:"d"}mjx-c.mjx-c2211.TEX-S2::before{padding:.95em 1.444em .45em 0;content:"∑"}mjx-c.mjx-c35::before{padding:.666em .5em .022em 0;content:"5"}mjx-c.mjx-c1D440.TEX-I::before{padding:.683em 1.051em 0 0;content:"M"}mjx-c.mjx-c1D438.TEX-I::before{padding:.68em .764em 0 0;content:"E"}mjx-c.mjx-c3C::before{padding:.54em .778em .04em 0;content:"<"}mjx-c.mjx-c1D462.TEX-I::before{padding:.442em .572em .011em 0;content:"u"}mjx-c.mjx-c5E::before{padding:.694em .5em 0 0;content:"^"}mjx-c.mjx-c7C::before{padding:.75em .278em .249em 0;content:"|"}mjx-c.mjx-c1D43C.TEX-I::before{padding:.683em .504em 0 0;content:"I"}mjx-c.mjx-c1D445.TEX-I::before{padding:.683em .759em .021em 0;content:"R"}mjx-c.mjx-c26::before{padding:.716em .778em .022em 0;content:"&"}mjx-c.mjx-c1D457.TEX-I::before{padding:.661em .412em .204em 0;content:"j"}mjx-c.mjx-c2217::before{padding:.465em .5em 0 0;content:"∗"}mjx-c.mjx-c1D434.TEX-I::before{padding:.716em .75em 0 0;content:"A"}mjx-c.mjx-c1D436.TEX-I::before{padding:.705em .76em .022em 0;content:"C"}mjx-c.mjx-c1D45A.TEX-I::before{padding:.442em .878em .011em 0;content:"m"}mjx-mtable{display:inline-block;text-align:center;vertical-align:.25em;position:relative;box-sizing:border-box;border-spacing:0px;border-collapse:collapse}mjx-mstyle[size="s"] mjx-mtable{vertical-align:.354em}mjx-labels{position:absolute;left:0;top:0}mjx-table{display:inline-block;vertical-align:-.5ex;box-sizing:border-box}mjx-table>mjx-itable{vertical-align:middle;text-align:left;box-sizing:border-box}mjx-labels>mjx-itable{position:absolute;top:0}mjx-mtable[justify=left]{text-align:left}mjx-mtable[justify=right]{text-align:right}mjx-mtable[justify=left][side=left]{padding-right:0!important}mjx-mtable[justify=left][side=right]{padding-left:0!important}mjx-mtable[justify=right][side=left]{padding-right:0!important}mjx-mtable[justify=right][side=right]{padding-left:0!important}mjx-mtable[align]{vertical-align:baseline}mjx-mtable[align=top]>mjx-table{vertical-align:top}mjx-mtable[align=bottom]>mjx-table{vertical-align:bottom}mjx-mtable[side=right] mjx-labels{min-width:100%}mjx-mtr{display:table-row;text-align:left}mjx-mtr[rowalign=top]>mjx-mtd{vertical-align:top}mjx-mtr[rowalign=center]>mjx-mtd{vertical-align:middle}mjx-mtr[rowalign=bottom]>mjx-mtd{vertical-align:bottom}mjx-mtr[rowalign=baseline]>mjx-mtd{vertical-align:baseline}mjx-mtr[rowalign=axis]>mjx-mtd{vertical-align:.25em}mjx-mtd{display:table-cell;text-align:center;padding:.215em .4em}mjx-mtd:first-child{padding-left:0}mjx-mtd:last-child{padding-right:0}mjx-mtable>*>mjx-itable>:first-child>mjx-mtd{padding-top:0}mjx-mtable>*>mjx-itable>:last-child>mjx-mtd{padding-bottom:0}mjx-tstrut{display:inline-block;height:1em;vertical-align:-.25em}mjx-labels[align=left]>mjx-mtr>mjx-mtd{text-align:left}mjx-labels[align=right]>mjx-mtr>mjx-mtd{text-align:right}mjx-mtd[extra]{padding:0}mjx-mtd[rowalign=top]{vertical-align:top}mjx-mtd[rowalign=center]{vertical-align:middle}mjx-mtd[rowalign=bottom]{vertical-align:bottom}mjx-mtd[rowalign=baseline]{vertical-align:baseline}mjx-mtd[rowalign=axis]{vertical-align:.25em}mjx-c.mjx-c36::before{padding:.666em .5em .022em 0;content:"6"}mjx-c.mjx-c1D456.TEX-I::before{padding:.661em .345em .011em 0;content:"i"}mjx-c.mjx-c1D453.TEX-I::before{padding:.705em .55em .205em 0;content:"f"}mjx-c.mjx-c1D437.TEX-I::before{padding:.683em .828em 0 0;content:"D"}mjx-c.mjx-c2F::before{padding:.75em .5em .25em 0;content:"/"}mjx-c.mjx-c2C::before{padding:.121em .278em .194em 0;content:","}mjx-c.mjx-c1D45F.TEX-I::before{padding:.442em .451em .011em 0;content:"r"}mjx-c.mjx-c3E::before{padding:.54em .778em .04em 0;content:">"}mjx-c.mjx-c1D464.TEX-I::before{padding:.443em .716em .011em 0;content:"w"}mjx-c.mjx-c1D461.TEX-I::before{padding:.626em .361em .011em 0;content:"t"}mjx-c.mjx-c210E.TEX-I::before{padding:.694em .576em .011em 0;content:"h"}mjx-c.mjx-c1D452.TEX-I::before{padding:.442em .466em .011em 0;content:"e"}mjx-c.mjx-c2248::before{padding:.483em .778em 0 0;content:"≈"}mjx-c.mjx-c37::before{padding:.676em .5em .022em 0;content:"7"}mjx-c.mjx-c1D460.TEX-I::before{padding:.442em .469em .01em 0;content:"s"}mjx-c.mjx-c1D467.TEX-I::before{padding:.442em .465em .011em 0;content:"z"}mjx-c.mjx-c21::before{padding:.716em .278em 0 0;content:"!"}mjx-c.mjx-c7B.TEX-S3::before{padding:1.45em .75em .949em 0;content:"{"}mjx-c.mjx-c1D43F.TEX-I::before{padding:.683em .681em 0 0;content:"L"}mjx-c.mjx-c2265::before{padding:.636em .778em .138em 0;content:"≥"}mjx-c.mjx-c2264::before{padding:.636em .778em .138em 0;content:"≤"}mjx-c.mjx-c30::before{padding:.666em .5em .022em 0;content:"0"}mjx-c.mjx-c1D44F.TEX-I::before{padding:.694em .429em .011em 0;content:"b"}mjx-c.mjx-c33::before{padding:.665em .5em .022em 0;content:"3"}mjx-c.mjx-c398::before{padding:.705em .778em .022em 0;content:"Θ"}mjx-c.mjx-c1D442.TEX-I::before{padding:.704em .763em .022em 0;content:"O"}mjx-c.mjx-c3A9::before{padding:.704em .722em 0 0;content:"Ω"}mjx-msub{display:inline-block;text-align:left}mjx-c.mjx-c1D459.TEX-I::before{padding:.694em .298em .011em 0;content:"l"}mjx-c.mjx-c1D45C.TEX-I::before{padding:.441em .485em .011em 0;content:"o"}mjx-c.mjx-c1D454.TEX-I::before{padding:.442em .477em .205em 0;content:"g"}mjx-c.mjx-c1D441.TEX-I::before{padding:.683em .888em 0 0;content:"N"}mjx-container[jax=CHTML]{line-height:0}mjx-container [space="1"]{margin-left:.111em}mjx-container [space="2"]{margin-left:.167em}mjx-container [space="3"]{margin-left:.222em}mjx-container [space="4"]{margin-left:.278em}mjx-container [space="5"]{margin-left:.333em}mjx-container [rspace="1"]{margin-right:.111em}mjx-container [rspace="2"]{margin-right:.167em}mjx-container [rspace="3"]{margin-right:.222em}mjx-container [rspace="4"]{margin-right:.278em}mjx-container [rspace="5"]{margin-right:.333em}mjx-container [size="s"]{font-size:70.7%}mjx-container [size=ss]{font-size:50%}mjx-container [size=Tn]{font-size:60%}mjx-container [size=sm]{font-size:85%}mjx-container [size=lg]{font-size:120%}mjx-container [size=Lg]{font-size:144%}mjx-container [size=LG]{font-size:173%}mjx-container [size=hg]{font-size:207%}mjx-container [size=HG]{font-size:249%}mjx-container [width=full]{width:100%}mjx-box{display:inline-block}mjx-block{display:block}mjx-itable{display:inline-table}mjx-row{display:table-row}mjx-row>*{display:table-cell}mjx-mtext{display:inline-block}mjx-mstyle{display:inline-block}mjx-merror{display:inline-block;color:red;background-color:#ff0}mjx-mphantom{visibility:hidden}mjx-assistive-mml{top:0;left:0;clip:rect(1px,1px,1px,1px);user-select:none;position:absolute!important;padding:1px 0 0!important;border:0!important;display:block!important;width:auto!important;overflow:hidden!important}mjx-assistive-mml[display=block]{width:100%!important}mjx-math{display:inline-block;text-align:left;line-height:0;text-indent:0;font-style:normal;font-weight:400;font-size:100%;letter-spacing:normal;border-collapse:collapse;overflow-wrap:normal;word-spacing:normal;white-space:nowrap;direction:ltr;padding:1px 0}mjx-container[jax=CHTML][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=CHTML][display=true][width=full]{display:flex}mjx-container[jax=CHTML][display=true] mjx-math{padding:0}mjx-container[jax=CHTML][justify=left]{text-align:left}mjx-container[jax=CHTML][justify=right]{text-align:right}mjx-mi{display:inline-block;text-align:left}mjx-c{display:inline-block}mjx-utext{display:inline-block;padding:.75em 0 .2em}mjx-mo{display:inline-block;text-align:left}mjx-stretchy-h{display:inline-table;width:100%}mjx-stretchy-h>*{display:table-cell;width:0}mjx-stretchy-h>*>mjx-c{display:inline-block;transform:scaleX(1)}mjx-stretchy-h>*>mjx-c::before{display:inline-block;width:initial}mjx-stretchy-h>mjx-ext{overflow:clip visible;width:100%}mjx-stretchy-h>mjx-ext>mjx-c::before{transform:scaleX(500)}mjx-stretchy-h>mjx-ext>mjx-c{width:0}mjx-stretchy-h>mjx-beg>mjx-c{margin-right:-.1em}mjx-stretchy-h>mjx-end>mjx-c{margin-left:-.1em}mjx-stretchy-v{display:inline-block}mjx-stretchy-v>*{display:block}mjx-stretchy-v>mjx-beg{height:0}mjx-stretchy-v>mjx-end>mjx-c{display:block}mjx-stretchy-v>*>mjx-c{transform:scaleY(1);transform-origin:left center;overflow:hidden}mjx-stretchy-v>mjx-ext{display:block;height:100%;box-sizing:border-box;border:0 solid transparent;overflow:visible clip}mjx-stretchy-v>mjx-ext>mjx-c::before{width:initial;box-sizing:border-box}mjx-stretchy-v>mjx-ext>mjx-c{transform:scaleY(500) translateY(.075em);overflow:visible}mjx-mark{display:inline-block;height:0}mjx-texatom{display:inline-block;text-align:left}mjx-munder{display:inline-block;text-align:left}mjx-over{text-align:left}mjx-munder:not([limits=false]){display:inline-table}mjx-munder>mjx-row{text-align:left}mjx-under{padding-bottom:.1em}mjx-mn{display:inline-block;text-align:left}mjx-mfrac{display:inline-block;text-align:left}mjx-frac{display:inline-block;vertical-align:.17em;padding:0 .22em}mjx-frac[type="d"]{vertical-align:.04em}mjx-frac[delims]{padding:0 .1em}mjx-frac[atop]{padding:0 .12em}mjx-frac[atop][delims]{padding:0}mjx-dtable{display:inline-table;width:100%}mjx-dtable>*{font-size:2000%}mjx-dbox{display:block;font-size:5%}mjx-num{display:block;text-align:center}mjx-den{display:block;text-align:center}mjx-mfrac[bevelled]>mjx-num{display:inline-block}mjx-mfrac[bevelled]>mjx-den{display:inline-block}mjx-den[align=right],mjx-num[align=right]{text-align:right}mjx-den[align=left],mjx-num[align=left]{text-align:left}mjx-nstrut{display:inline-block;height:.054em;width:0;vertical-align:-.054em}mjx-nstrut[type="d"]{height:.217em;vertical-align:-.217em}mjx-dstrut{display:inline-block;height:.505em;width:0}mjx-dstrut[type="d"]{height:.726em}mjx-line{display:block;box-sizing:border-box;min-height:1px;height:.06em;border-top:.06em solid;margin:.06em -.1em;overflow:hidden}mjx-line[type="d"]{margin:.18em -.1em}mjx-mrow{display:inline-block;text-align:left}mjx-msup{display:inline-block;text-align:left}mjx-c::before{display:block;width:0}.MJX-TEX{font-family:MJXZERO,MJXTEX}.TEX-B{font-family:MJXZERO,MJXTEX-B}.TEX-I{font-family:MJXZERO,MJXTEX-I}.TEX-MI{font-family:MJXZERO,MJXTEX-MI}.TEX-BI{font-family:MJXZERO,MJXTEX-BI}.TEX-S1{font-family:MJXZERO,MJXTEX-S1}.TEX-S2{font-family:MJXZERO,MJXTEX-S2}.TEX-S3{font-family:MJXZERO,MJXTEX-S3}.TEX-S4{font-family:MJXZERO,MJXTEX-S4}.TEX-A{font-family:MJXZERO,MJXTEX-A}.TEX-C{font-family:MJXZERO,MJXTEX-C}.TEX-CB{font-family:MJXZERO,MJXTEX-CB}.TEX-FR{font-family:MJXZERO,MJXTEX-FR}.TEX-FRB{font-family:MJXZERO,MJXTEX-FRB}.TEX-SS{font-family:MJXZERO,MJXTEX-SS}.TEX-SSB{font-family:MJXZERO,MJXTEX-SSB}.TEX-SSI{font-family:MJXZERO,MJXTEX-SSI}.TEX-SC{font-family:MJXZERO,MJXTEX-SC}.TEX-T{font-family:MJXZERO,MJXTEX-T}.TEX-V{font-family:MJXZERO,MJXTEX-V}.TEX-VB{font-family:MJXZERO,MJXTEX-VB}mjx-stretchy-h mjx-c,mjx-stretchy-v mjx-c{font-family:MJXZERO,MJXTEX-S1,MJXTEX-S4,MJXTEX,MJXTEX-A!important}@font-face{font-family:MJXZERO;src:url("lib/fonts/mathjax_zero.woff") format("woff")}@font-face{font-family:MJXTEX;src:url("lib/fonts/mathjax_main-regular.woff") format("woff")}@font-face{font-family:MJXTEX-B;src:url("lib/fonts/mathjax_main-bold.woff") format("woff")}@font-face{font-family:MJXTEX-I;src:url("lib/fonts/mathjax_math-italic.woff") format("woff")}@font-face{font-family:MJXTEX-MI;src:url("lib/fonts/mathjax_main-italic.woff") format("woff")}@font-face{font-family:MJXTEX-BI;src:url("lib/fonts/mathjax_math-bolditalic.woff") format("woff")}@font-face{font-family:MJXTEX-S1;src:url("lib/fonts/mathjax_size1-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S2;src:url("lib/fonts/mathjax_size2-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S3;src:url("lib/fonts/mathjax_size3-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S4;src:url("lib/fonts/mathjax_size4-regular.woff") format("woff")}@font-face{font-family:MJXTEX-A;src:url("lib/fonts/mathjax_ams-regular.woff") format("woff")}@font-face{font-family:MJXTEX-C;src:url("lib/fonts/mathjax_calligraphic-regular.woff") format("woff")}@font-face{font-family:MJXTEX-CB;src:url("lib/fonts/mathjax_calligraphic-bold.woff") format("woff")}@font-face{font-family:MJXTEX-FR;src:url("lib/fonts/mathjax_fraktur-regular.woff") format("woff")}@font-face{font-family:MJXTEX-FRB;src:url("lib/fonts/mathjax_fraktur-bold.woff") format("woff")}@font-face{font-family:MJXTEX-SS;src:url("lib/fonts/mathjax_sansserif-regular.woff") format("woff")}@font-face{font-family:MJXTEX-SSB;src:url("lib/fonts/mathjax_sansserif-bold.woff") format("woff")}@font-face{font-family:MJXTEX-SSI;src:url("lib/fonts/mathjax_sansserif-italic.woff") format("woff")}@font-face{font-family:MJXTEX-SC;src:url("lib/fonts/mathjax_script-regular.woff") format("woff")}@font-face{font-family:MJXTEX-T;src:url("lib/fonts/mathjax_typewriter-regular.woff") format("woff")}@font-face{font-family:MJXTEX-V;src:url("lib/fonts/mathjax_vector-regular.woff") format("woff")}@font-face{font-family:MJXTEX-VB;src:url("lib/fonts/mathjax_vector-bold.woff") format("woff")}mjx-c.mjx-c1D45B.TEX-I::before{padding:.442em .6em .011em 0;content:"n"}mjx-c.mjx-c2192::before{padding:.511em 1em .011em 0;content:"→"}mjx-c.mjx-c221E::before{padding:.442em 1em .011em 0;content:"∞"}mjx-c.mjx-c6C::before{padding:.694em .278em 0 0;content:"l"}mjx-c.mjx-c69::before{padding:.669em .278em 0 0;content:"i"}mjx-c.mjx-c6D::before{padding:.442em .833em 0 0;content:"m"}mjx-c.mjx-c1D44E.TEX-I::before{padding:.441em .529em .01em 0;content:"a"}mjx-c.mjx-c2B::before{padding:.583em .778em .082em 0;content:"+"}mjx-c.mjx-c28::before{padding:.75em .389em .25em 0;content:"("}mjx-c.mjx-c31::before{padding:.666em .5em 0 0;content:"1"}mjx-c.mjx-c29::before{padding:.75em .389em .25em 0;content:")"}mjx-c.mjx-c2E::before{padding:.12em .278em 0 0;content:"."}mjx-c.mjx-c3D::before{padding:.583em .778em .082em 0;content:"="}mjx-c.mjx-c5B::before{padding:.75em .278em .25em 0;content:"["}mjx-c.mjx-c5D::before{padding:.75em .278em .25em 0;content:"]"}mjx-c.mjx-cD7::before{padding:.491em .778em 0 0;content:"×"}mjx-c.mjx-c32::before{padding:.666em .5em 0 0;content:"2"}mjx-c.mjx-c34::before{padding:.677em .5em 0 0;content:"4"}mjx-c.mjx-c38::before{padding:.666em .5em .022em 0;content:"8"}mjx-c.mjx-c2026::before{padding:.12em 1.172em 0 0;content:"…"}mjx-c.mjx-c1D465.TEX-I::before{padding:.442em .572em .011em 0;content:"x"}mjx-c.mjx-c2212::before{padding:.583em .778em .082em 0;content:"−"}</style><pre class="frontmatter language-yaml" tabindex="0" style="display: none;"><code class="language-yaml is-loaded"><span class="token key atrule">week</span><span class="token punctuation">:</span> 第四周
<span class="token key atrule">dg-publish</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="Lecture 06 Memory &amp; Disk IO Management"><p dir="auto">Lecture 06 Memory &amp; Disk IO Management</p></h1><div class="el-p"><p dir="auto"><strong>today's agenda</strong></p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">Buffer Pool Manager </li>
<li data-line="1" dir="auto">Disk I/O Scheduling </li>
<li data-line="2" dir="auto">Replacement Policies </li>
<li data-line="3" dir="auto">Other Memory Pools</li>
</ul></div><div class="el-p"><embed src="lib/media/06-bufferpool.pdf" style="width: 100%; max-width: 100%; height: 751.812px;"></div><div class="el-p"><p dir="auto">上节课结束了数据库存储方面的讨论 -- 着重讨论了数据库系统如何在磁盘上表示数据<br>
从这个Lecture开始 主要探讨的是如何从磁盘获取这些页面  并引入内存  并进行相应的处理<br>
again 我们的目标是拥有一个数据系统 营造出一种错句 --  我们拥有的内存比实际更多</p></div><div class="el-p"><p dir="auto">Lecture 6 要讨论的是 如果从磁盘获取所需的数据页  载入内存 </p></div><div class="el-p"><p dir="auto">在磁盘间移动数据 </p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">
<p>我们的页面写入磁盘的哪个位置</p>
</li>
<li data-line="1" dir="auto">
<p>如何才能以一种方式排列  以便最大化IO的量</p>
</li>
<li data-line="3" dir="auto">
<p>预取技术</p>
</li>
<li data-line="4" dir="auto">
<p>将数据带入内存   何时把数据从内存中驱逐出去？</p>
</li>
</ul></div><div class="el-p"><p dir="auto">buffer pool management / buffer pool cache  --  数据库系统从操作系统中分配并自行控制的内存<br>
<span alt="Pasted image 20250207180213.png" src="Pasted image 20250207180213.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250207180213.png" src="lib/media/pasted-image-20250207180213.png"></span><br>
<span alt="Pasted image 20250207180226.png" src="Pasted image 20250207180226.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250207180226.png" src="lib/media/pasted-image-20250207180226.png"></span></p></div><div class="el-p"><p dir="auto">每次进入buffer pool的位置可能不同</p></div><div class="el-p"><p dir="auto"><strong>today's agenda</strong></p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">Buffer Pool Manager<br>
什么是buffer pool manager<br>
优化措施</li>
<li data-line="3" dir="auto">Replacement Policies<br>
buffer pool 替换策略</li>
<li data-line="5" dir="auto">Disk I/O Scheduling<br>
磁盘IO调度</li>
<li data-line="7" dir="auto">Other Memory Pools<br>
其他内存池</li>
</ul></div><div class="el-h3 heading-wrapper"><h3 data-heading="Buffer Pool Manager" dir="auto" class="heading" id="Buffer_Pool_Manager"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Buffer Pool Manager</h3><div class="heading-children"><div class="el-p"><p dir="auto">事实上是操作系统 分配的 一块内存空间<br>
我们逻辑上将其分割成固定大小的页面 -- 以page为度量  称为 frame  --  帧<br>
系统启动 --  malloc -- 获取一部分内存 -- 分成帧<br>
开始请求page的时候  我们将磁盘中的page精确复制到memory  找空闲帧<br>
<span alt="Pasted image 20250207181458.png" src="Pasted image 20250207181458.png" class="internal-embed media-embed image-embed is-loaded" style="width: 300px; max-width: 100%;"><img alt="Pasted image 20250207181458.png" src="lib/media/pasted-image-20250207181458.png" style="width: 300px; max-width: 100%;"></span><br>
如果我们修改了页面中的内容 并不需要立即放回disk<br>
这里涉及到了机组上学的 cache的写回法和写直达法 见<a data-href="高速缓冲存储器" href="lcu-principles-of-computer-composition/高速缓冲存储器.html" class="internal-link" target="_self" rel="noopener nofollow">高速缓冲存储器</a><br>
有一个 write-ahead log （预写日志） 会记录我们所做的更改 并且会确保在脏页刷新到磁盘之前 该日志文件已先行刷新至磁盘<br>
Dirty Page(脏页)：Dirty pages are buffered and not written to disk immediately →Write-Back Cache</p></div><div class="el-p"><p dir="auto">内部数据结构 跟踪实际存在于frame中的内容 --  page table 页表 （操作系统也有自己的page table）<br>
通常会使用一个固定大小的哈希表  用于记录所有帧的信息  每个帧通过特定的帧ID进行标识 然后再该页中存储当前页的相关信息 可能是个页面指针？ --给出page ID   就能 拿到该页面的指针<br>
使用一个latch来保护页表 --  类似于mutex（互斥锁） 允许我们让多个线程或多个工作进程同时访问页表  阻止其他线程？<br>
除了记录页面指针 以及 frame中的信息外    还拥有 additional mete-data per page 额外元数据</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">Dirty Flag</li>
<li data-line="1" dir="auto">Pin / Reference Counter(引用计数器)  跟踪该页面保持在内存中的workers的数量 -- 在驱逐时 不能被驱逐   就是有一个小计数器 表示 有一个工作进程在访问</li>
<li data-line="2" dir="auto">Access Tracking Information: </li>
</ul></div><div class="el-p"><p dir="auto">假设来了一个查询 不存在page table中  首先要加锁保护  然后获取所需数据<br>
<span alt="Pasted image 20250207191427.png" src="Pasted image 20250207191427.png" class="internal-embed media-embed image-embed is-loaded" style="width: 300px; max-width: 100%;"><img alt="Pasted image 20250207191427.png" src="lib/media/pasted-image-20250207191427.png" style="width: 300px; max-width: 100%;"></span><br>
然后再缓冲池更新一个空闲帧 --》 更新页表 --》更新元数据（例如谁访问了页面 最后一次访问时间等等）<br>
<span alt="Pasted image 20250207191552.png" src="Pasted image 20250207191552.png" class="internal-embed media-embed image-embed is-loaded" style="width: 300px; max-width: 100%;"><img alt="Pasted image 20250207191552.png" src="lib/media/pasted-image-20250207191552.png" style="width: 300px; max-width: 100%;"></span><br>
<span alt="Pasted image 20250207191605.png" src="Pasted image 20250207191605.png" class="internal-embed media-embed image-embed is-loaded" style="width: 300px; max-width: 100%;"><img alt="Pasted image 20250207191605.png" src="lib/media/pasted-image-20250207191605.png" style="width: 300px; max-width: 100%;"></span><br>
一旦查询完成了对该表所需的更新操作  --  释放锁存器 -- 将工作线程返回到原先的任务重<br>
<span alt="Pasted image 20250207191654.png" src="Pasted image 20250207191654.png" class="internal-embed media-embed image-embed is-loaded" style="width: 300px; max-width: 100%;"><img alt="Pasted image 20250207191654.png" src="lib/media/pasted-image-20250207191654.png" style="width: 300px; max-width: 100%;"></span><br>
此后 任何寻求第二页的其他工作线程都能在page table中找到</p></div><div class="el-p"><p dir="auto"> 这里使用的是latch  not  lock<br>
<strong>locks vs latches</strong><br>
锁是用来保护数据库中更高层次的概念或对象的 -- table  tuple<br>
保护数据库的逻辑内容免受其他事务的影响 --  我们还没有讨论什么是事务  -- 比如 我们要执行多个更新操作 进行多次往返的SQL查询 -- 如果我对某项资源加锁 我希望在某个事务期间持有该锁<br>
lecture是低级的内部原语  保护数据库系统的关键部分</p></div><div class="el-p"><p dir="auto"><strong>什么是latch -- DeepSeek</strong><br>
好的，我现在要理解数据库系统中的latch如何保护页表（page table）。首先，我需要明确几个概念：什么是latch，什么是页表，以及它们在数据库系统中的作用。<br>
首先，latch在数据库中通常指的是轻量级的锁机制，用于短时间的同步，确保数据结构在并发访问时的一致性。与操作系统的锁（如mutex）不同，latch通常持有时间更短，用于保护内部数据结构，比如缓冲池中的页表。<br>
页表在操作系统中是用来将虚拟地址映射到物理地址的数据结构，但在数据库系统中，可能指的是缓冲池中的页表，用来跟踪哪些数据页在内存中，它们的状态等信息。缓冲池管理着从磁盘读取的数据页，供事务快速访问，因此页表需要高效且正确地被管理，以避免并发问题，比如多个线程同时修改同一页表项导致的数据不一致。<br>
那问题来了，latch如何保护页表？可能的思路是，当多个线程需要访问或修改页表时，通过获取latch来确保同一时间只有一个线程可以修改页表结构，防止竞态条件。例如，当一个线程要修改页表项的状态（比如标记为脏页），它需要先获取对应的latch，修改完成后释放。其他线程必须等待latch释放后才能继续操作，从而保证操作的原子性。<br>
接下来要考虑的是latch的类型。可能有共享latch和排他latch。<strong>读操作可以获取共享latch，允许多个读并发，而写操作需要排他latch，独占访问</strong>。比如，当读取页表项时，获取共享latch，多个读可以同时进行；当要修改页表项时，必须获得排他latch，此时其他读或写都必须等待。<br>
另外，需要确定页表的粒度。整个页表可能被一个全局的latch保护，但这可能导致性能瓶颈，因为每次访问页表都要竞争这个latch。<strong>另一种方式是对页表进行分片，每个分片有自己的latch，减少竞争</strong>。例如，根据页号哈希到不同的分片，每个分片独立加锁，这样不同页的访问可以并行处理，提高并发性。<br>
实际应用中，比如MySQL的InnoDB缓冲池管理，可能使用了类似的机制。当需要从缓冲池中获取一个页时，会先锁定对应的latch，防止其他线程同时修改该页的控制结构。<strong>例如，当需要置换出一个页时，必须锁定相关的latch，确保在修改页表项时不会被其他操作干扰。</strong><br>
但是，可能存在的疑问是，latch和锁（lock）的区别。在数据库中，锁通常指事务级别的锁，用于保证ACID属性，比如行锁、表锁，而latch是更底层的保护机制，用于内存数据结构的并发控制，比如保护缓冲池、页表等，两者的作用域和生命周期不同。Latch通常在操作完成后立即释放，而锁可能持续到事务结束。<br>
还需要考虑错误处理，比如获取latch失败时的重试机制，或者死锁检测。但latch通常设计为不会有死锁，或者通过严格的获取顺序来避免。例如，所有线程按固定顺序申请多个latch，或者使用try-latch并在失败时回退操作。<br>
可能遇到的问题包括：如何减少latch竞争以提高性能？<strong>分片是一种方法，但分片的数量需要权衡，过多会增加内存开销，过少可能无法有效降低竞争</strong>。另外，是否所有操作都需要latch？例如，只读操作是否需要获取共享latch，或者是否有无锁的数据结构可用？<br>
还有一个例子是，当页表中某个页被淘汰出去时，需要修改页表项，标记该页为不在内存中，或者更新其位置。这时必须用排他latch来确保这个过程不会被其他线程中断，比如另一个线程同时试图读取该页的内容，导致不一致的状态。<br>
总结的话，latch在数据库系统中保护页表主要是通过提供并发的访问控制，确保页表数据结构的完整性和一致性。通过共享和排他模式，以及分片策略，平衡并发性能和数据安全。</p></div><div class="el-p"><p dir="auto"><strong>page table vs  page directory</strong></p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">The page directory is the mapping from page ids to page locations in the database files<br>
All changes must be recorded on disk to allow the DBMS to find on restart.</li>
<li data-line="2" dir="auto">The page table is the mapping from page ids to a copy of the page in buffer pool frames<br>
This is an in-memory data structure that does not need to be stored on disk.<br>
一般情况下 先看page table  当page table没有的话  才会调用磁盘调度机制   从磁盘上获取该页面  放入页表中</li>
</ul></div><div class="el-p"><p dir="auto"><strong>Allocation Policies</strong></p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">Global Policies<br>
考虑所有活动事务 找到 分配内存的最佳决策</li>
<li data-line="2" dir="auto">Local Policies<br>
- 它做出的决策将使 单个查询或事务运行更快  即使不利于整个工作负载<br>
- 本地策略将frame分配给特定事物 而不考虑并发事务的行为<br>
大多数系统 同时使用 Global Policies 和 Local Policies</li>
</ul></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="Buffer Pool Optimizats" dir="auto" class="heading" id="Buffer_Pool_Optimizats"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Buffer Pool Optimizats</h3><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto">Multiple Buffer Pools</li>
<li data-line="1" dir="auto">Pre-Fetching</li>
<li data-line="2" dir="auto">Scan Sharing</li>
<li data-line="3" dir="auto">Buffer Pool Bypass<br>
不能说哪种更好   --  大部分数据库系统会选择其中的组合或者大多数</li>
</ul></div><div class="el-h4 heading-wrapper"><h4 data-heading="Multiple Buffer Pools" dir="auto" class="heading" id="Multiple_Buffer_Pools"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Multiple Buffer Pools</h4><div class="heading-children"><div class="el-p"><p dir="auto">前面介绍的实例   只有一个page table  一组frame组成   由于存在多个工作进程同时进行  我们采用了latch 来保护数据结构<br>
而这对于大量CPU核心同时运行大量工作线程的情况  这些latch 将 成为瓶颈<br>
缓解这一点的简单方法就是使用多个缓冲池</p></div><div class="el-p"><p dir="auto">仍然分配相同数量的内存 但是分割成大小相等的块  并为每一块创建一个单独的页表<br>
DB2 可以定制  缓冲池管理  --  比如允许哪些表  被 哪个缓冲池管理</p></div><div class="el-p"><p dir="auto">Mysql, Oracle, SQL Server</p></div><div class="el-p"><p dir="auto">问题是  在运行时  应该确定哪个缓冲池管理器</p></div><div class="el-p"><p dir="auto">example  I have two buffer pool.  123 由 buffer pool1 管理  456由buffer pool2 管理</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">Approach 1: Object Id<br>
<span alt="Pasted image 20250210093613.png" src="Pasted image 20250210093613.png" class="internal-embed media-embed image-embed is-loaded" style="width: 400px; max-width: 100%;"><img alt="Pasted image 20250210093613.png" src="lib/media/pasted-image-20250210093613.png" style="width: 400px; max-width: 100%;"></span><br>
SQL Server中还有个Object ID</li>
<li data-line="3" dir="auto">Approach 2: Hashing<br>
最简单的方法 -- MySQL  对记录id进行哈希处理 调整缓冲池数量<br>
<span alt="Pasted image 20250210093859.png" src="Pasted image 20250210093859.png" class="internal-embed media-embed image-embed is-loaded" style="width: 400px; max-width: 100%;"><img alt="Pasted image 20250210093859.png" src="lib/media/pasted-image-20250210093859.png" style="width: 400px; max-width: 100%;"></span><br>
涉及到 hash的方法  和  处理hash 碰撞的 方法</li>
</ul></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="Pre-Fetching" dir="auto" class="heading" id="Pre-Fetching"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Pre-Fetching</h4><div class="heading-children"><div class="el-p"><p dir="auto">prefetch  --  预取技术</p></div><div class="el-h5 heading-wrapper"><h5 data-heading="Sequential Scans" dir="auto" class="heading" id="Sequential_Scans"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Sequential Scans</h5><div class="heading-children"><div class="el-p"><p dir="auto">基本思路是  当运行一个查询时  如果它需要开始访问表中的数据  就会打开一个游标  逐页逐页的扫描<br>
<span alt="Pasted image 20250210094548.png" src="Pasted image 20250210094548.png" class="internal-embed media-embed image-embed is-loaded" style="width: 400px; max-width: 100%;"><img alt="Pasted image 20250210094548.png" src="lib/media/pasted-image-20250210094548.png" style="width: 400px; max-width: 100%;"></span><br>
现在数据系统可以智能化的判断 --  可能继续读page2 page3  所以在DBMS在处理page1的时候  去获取了page2 page3 放入缓存<br>
<span alt="Pasted image 20250210094725.png" src="Pasted image 20250210094725.png" class="internal-embed media-embed image-embed is-loaded" style="width: 400px; max-width: 100%;"><img alt="Pasted image 20250210094725.png" src="lib/media/pasted-image-20250210094725.png" style="width: 400px; max-width: 100%;"></span><br>
所以当Q1继续往后  所需要的page2 已经存好了</p></div><div class="el-p"><p dir="auto">不同的buffer pool 不会存同一个page  -- 始终一一对应<br>
执行查询的过程：请求一个页面  包含多个Tuple  在哪些tuple内的数据进行某种计算  当完成当前页的操作后 继续获取下一页 以便在查询计划树的叶子结点上进行扫描</p></div><div class="el-p"><p dir="auto">上面这一部分是操作系统可以推理出来的  他无法做到的是推理出页面物理上所表示的逻辑数据结构 并据此进行预取</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="Index Scans" dir="auto" class="heading" id="Index_Scans"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Index Scans</h5><div class="heading-children"><div class="el-p"><p dir="auto">假设有一个查询</p></div><div class="el-pre"><pre class="language-sql" tabindex="0"><code data-line="0" class="language-sql is-loaded"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> A <span class="token keyword">WHERE</span> val <span class="token operator">BETWEEN</span> <span class="token number">100</span> <span class="token operator">AND</span> <span class="token number">250</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250210101348.png" src="Pasted image 20250210101348.png" class="internal-embed media-embed image-embed is-loaded" style="width: 400px; max-width: 100%;"><img alt="Pasted image 20250210101348.png" src="lib/media/pasted-image-20250210101348.png" style="width: 400px; max-width: 100%;"></span><br>
b+树<br>
<span alt="Pasted image 20250210101457.png" src="Pasted image 20250210101457.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250210101457.png" src="lib/media/pasted-image-20250210101457.png"></span><br>
<span alt="Pasted image 20250210101516.png" src="Pasted image 20250210101516.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250210101516.png" src="lib/media/pasted-image-20250210101516.png"></span></p></div></div></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="scan sharing(synchronized scans)" dir="auto" class="heading" id="scan_sharing(synchronized_scans)"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>scan sharing(synchronized scans)</h4><div class="heading-children"><div class="el-p"><p dir="auto">扫描共享 or 同步扫描<br>
核心思想：当多个查询同时请求访问同一表格时，其中一个查询开始执行，逐页扫描数据，我们能够识别到这些查询所需的数据相同，因此，我们只需要借助已启动查询的扫描结果，实现数据的共享访问<br>
两个游标相连，同时读取相同的页面<br>
扫描共享实际上位于访问方法的较低的物理层级 即如果实际扫描页面 我们能够识别出两个查询需要读取相同的内容 因此 我们可以在检索过程中重复使用任何页面   -》 因此避免了冲突的游标试图同时读取同一页面的情况 ？？<br>
有先后顺序？<br>
DB2, SQL Server, Teradata 和 Postgres 支持非完全相同查询的完整扫描共享<br>
Oracle 仅支持完全相同的查询进行游标共享<br>
<span alt="Pasted image 20250213203800.png" src="Pasted image 20250213203800.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250213203800.png" src="lib/media/pasted-image-20250213203800.png"></span><br>
Oracle的文档中说明了 这三句其实并不匹配  因为在进行字符串哈希处理时  他们并不相同<br>
Process:</p></div><div class="el-pre"><pre class="language-sql" tabindex="0"><code data-line="0" class="language-sql is-loaded"><span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token keyword">From</span> A
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250213204025.png" src="Pasted image 20250213204025.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250213204025.png" src="lib/media/pasted-image-20250213204025.png"></span><br>
查询二出现</p></div><div class="el-pre"><pre class="language-sql" tabindex="0"><code data-line="0" class="language-sql is-loaded"><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token keyword">From</span> A
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">正常的做法应该是生成游标Q2 然后从page0开始读取  -- but stupid  因为page0 刚刚被移除<br>
更佳的做法 是 将Q2 附加到 Q1上 在扫描表时 再次从最低层级开始  并让Q2随Q1一同遍历到最后  然后Q2意识到 表顶端有一些页面之前遗漏了  然后回去获取那些数据<br>
有什么问题？<br>
如果我想获取前100条数据</p></div><div class="el-pre"><pre class="language-sql" tabindex="0"><code data-line="0" class="language-sql is-loaded"><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token keyword">From</span> A <span class="token keyword">LIMIT</span> <span class="token number">100</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">由于关系型数据库 是无序的  从理论上来说  这样也是正确的<br>
但是从应用视角来看  比较混乱 -- 因为不同时间点会呈现不同的结果<br>
所以scan sharing的棘手处在于 理解和把握实际意图的语句  进而确定何时安全将一个游标附加到另一个游标上 and 如何在需要时 回溯 获得准确的结果<br>
走向极端的扫描共享 -- continuous scan sharing   连续扫描共享<br>
实际上没有任何系统这么做  但是 思维很有趣<br>
哈哈哈哈哈 一直在动  然后带上 查询 就走<br>
<span alt="Pasted image 20250213205238.png" src="Pasted image 20250213205238.png" class="internal-embed media-embed image-embed is-loaded" style="width: 100px; max-width: 100%;"><img alt="Pasted image 20250213205238.png" src="lib/media/pasted-image-20250213205238.png" style="width: 100px; max-width: 100%;"></span><br>
<span alt="Pasted image 20250213205314.png" src="Pasted image 20250213205314.png" class="internal-embed media-embed image-embed is-loaded" style="width: 100px; max-width: 100%;"><img alt="Pasted image 20250213205314.png" src="lib/media/pasted-image-20250213205314.png" style="width: 100px; max-width: 100%;"></span><br>
<span alt="Pasted image 20250213205344.png" src="Pasted image 20250213205344.png" class="internal-embed media-embed image-embed is-loaded" style="width: 100px; max-width: 100%;"><img alt="Pasted image 20250213205344.png" src="lib/media/pasted-image-20250213205344.png" style="width: 100px; max-width: 100%;"></span><br>
但有一个原型 真的这么做 -- Crescendo  来自 苏黎世联邦理工学院</p></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="Buffer Pool Bypass" dir="auto" class="heading" id="Buffer_Pool_Bypass"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Buffer Pool Bypass</h4><div class="heading-children"><div class="el-p"><p dir="auto">缓冲池旁路<br>
核心：如果我们有一个执行顺序扫描的查询 我们必须从磁盘读取到内存中 但或许我们并不想将其纳入我们的缓冲池<br>
reason </p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">我们必须承担缓冲池的维护成本</li>
<li data-line="1" dir="auto">如果进行顺序扫描  刚刚读取的数据 可能实际上并没有用<br>
与其让不同的工作人员同时顺序扫描 -- 脏页-- 给每个工作人员分配一小块内存 然后将读取的任何页面放入该工作人员的内存中   只读<br>
Oracle, PostgreSQL, SQL Server, Informix都支持  在Informix中叫  Light Scans 轻量扫描</li>
<li data-line="4" dir="auto">advantage: 不会污染页表</li>
<li data-line="5" dir="auto">disadvantage: 如果两个人要相继访问相同的页面 共享能力会丧失 失去重复利用的可能性<br>
so 权衡</li>
</ul></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="Replacement Policies" dir="auto" class="heading" id="Replacement_Policies"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Replacement Policies</h3><div class="heading-children"><div class="el-p"><p dir="auto">执行引擎表示 将一个page加载到内存中  并放置于一个 frame 中  若没有空间的frame 就必须要淘汰<br>
需要考虑的指标和目标<br>
- Correctness: 不希望驱逐一个页面后 该页面立刻成为最常用的对象<br>
- Accuracy<br>
- Speed: 不希望使用NP完全算法 或指数级算法<br>
- Meta-data overhead: 不希望为维护所需的元数据付出高昂的代价</p></div><div class="el-p"><p dir="auto">计组 Cache 替换策略 </p></div><div class="el-h4 heading-wrapper"><h4 data-heading="LRU -- Least Recently Used" dir="auto" class="heading" id="LRU_--_Least_Recently_Used"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>LRU -- Least Recently Used</h4><div class="heading-children"><div class="el-p"><p dir="auto">最近最少使用<br>
核心思路是维护一个时间戳 或 追踪一个链表 记录页面最后一次被访问的时间 打需要驱逐页面时 我们只需要前往链表的末端 并弹出那里的任何内容<br>
访问page1  page1在list中 所以移动<br>
<span alt="Pasted image 20250213213214.png" src="Pasted image 20250213213214.png" class="internal-embed media-embed image-embed is-loaded" style="width: 300px; max-width: 100%;"><img alt="Pasted image 20250213213214.png" src="lib/media/pasted-image-20250213213214.png" style="width: 300px; max-width: 100%;"></span><br>
<span alt="Pasted image 20250213213425.png" src="Pasted image 20250213213425.png" class="internal-embed media-embed image-embed is-loaded" style="width: 300px; max-width: 100%;"><img alt="Pasted image 20250213213425.png" src="lib/media/pasted-image-20250213213425.png" style="width: 300px; max-width: 100%;"></span><br>
<span alt="Pasted image 20250213213445.png" src="Pasted image 20250213213445.png" class="internal-embed media-embed image-embed is-loaded" style="width: 300px; max-width: 100%;"><img alt="Pasted image 20250213213445.png" src="lib/media/pasted-image-20250213213445.png" style="width: 300px; max-width: 100%;"></span></p></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="Clock" dir="auto" class="heading" id="Clock"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Clock</h4><div class="heading-children"><div class="el-p"><p dir="auto">另一种在不跟踪此链表中世纪时间戳的情况下 实现相同效果的方法 是使用一种 clock(时钟)的近似算法<br>
核心思想：不再追踪LRU中页面的精确顺序 而是为每个使用的页面设置一个简单的引用位 用以记录 每当该位置为1时 页面被访问 写入 或 读取的时刻<br>
我们将有一个时钟指针扫过并查看所有的页面  如果位被设置为1  将其设置为0  如果将其设为0  我们会进行驱逐操作<br>
process：<br>
假设 访问page1  设置为1<br>
<span alt="Pasted image 20250213214922.png" src="Pasted image 20250213214922.png" class="internal-embed media-embed image-embed is-loaded" style="width: 200px; max-width: 100%;"><img alt="Pasted image 20250213214922.png" src="lib/media/pasted-image-20250213214922.png" style="width: 200px; max-width: 100%;"></span><br>
<span alt="Pasted image 20250213214945.png" src="Pasted image 20250213214945.png" class="internal-embed media-embed image-embed is-loaded" style="width: 200px; max-width: 100%;"><img alt="Pasted image 20250213214945.png" src="lib/media/pasted-image-20250213214945.png" style="width: 200px; max-width: 100%;"></span><br>
接下来 假设一个查询需要访问缓冲池中不存在的页面  开始决定淘汰哪一个<br>
page1 为1 置为0   继续转  page2为0  所以驱逐<br>
<span alt="Pasted image 20250213215001.png" src="Pasted image 20250213215001.png" class="internal-embed media-embed image-embed is-loaded" style="width: 200px; max-width: 100%;"><img alt="Pasted image 20250213215001.png" src="lib/media/pasted-image-20250213215001.png" style="width: 200px; max-width: 100%;"></span><br>
<span alt="Pasted image 20250213215019.png" src="Pasted image 20250213215019.png" class="internal-embed media-embed image-embed is-loaded" style="width: 200px; max-width: 100%;"><img alt="Pasted image 20250213215019.png" src="lib/media/pasted-image-20250213215019.png" style="width: 200px; max-width: 100%;"></span><br>
<span alt="Pasted image 20250213215039.png" src="Pasted image 20250213215039.png" class="internal-embed media-embed image-embed is-loaded" style="width: 200px; max-width: 100%;"><img alt="Pasted image 20250213215039.png" src="lib/media/pasted-image-20250213215039.png" style="width: 200px; max-width: 100%;"></span></p></div><div class="el-p"><p dir="auto">假设page4 和page3 都被访问了<br>
<span alt="Pasted image 20250213215428.png" src="Pasted image 20250213215428.png" class="internal-embed media-embed image-embed is-loaded" style="width: 200px; max-width: 100%;"><img alt="Pasted image 20250213215428.png" src="lib/media/pasted-image-20250213215428.png" style="width: 200px; max-width: 100%;"></span><br>
<span alt="Pasted image 20250213215444.png" src="Pasted image 20250213215444.png" class="internal-embed media-embed image-embed is-loaded" style="width: 200px; max-width: 100%;"><img alt="Pasted image 20250213215444.png" src="lib/media/pasted-image-20250213215444.png" style="width: 200px; max-width: 100%;"></span></p></div><div class="el-p"><p dir="auto"><strong>good idea or bad idea？</strong><br>
LRU和Clock 都存在的缺点  </p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">没有跟踪被访问的频率  即那些页面被访问了<br>
在两种情况下  容易遭受  sequential flooding(顺序洪泛)的问题<br>
be like<br>
<span alt="Pasted image 20250213215957.png" src="Pasted image 20250213215957.png" class="internal-embed media-embed image-embed is-loaded" style="width: 300px; max-width: 100%;"><img alt="Pasted image 20250213215957.png" src="lib/media/pasted-image-20250213215957.png" style="width: 300px; max-width: 100%;"></span><br>
<span alt="Pasted image 20250213220020.png" src="Pasted image 20250213220020.png" class="internal-embed media-embed image-embed is-loaded" style="width: 300px; max-width: 100%;"><img alt="Pasted image 20250213220020.png" src="lib/media/pasted-image-20250213220020.png" style="width: 300px; max-width: 100%;"></span><br>
so bad</li>
</ul></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="Better Policies LRU-K" dir="auto" class="heading" id="Better_Policies_LRU-K"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Better Policies LRU-K</h4><div class="heading-children"><div class="el-p"><p dir="auto">解决方案被称为 LRU-K<br>
思路是 记录一个页面被访问的最后k次<br>
当决定要驱逐的时候  k次访问的间隔<br>
大多数系统实现这个  通常会记录 最近 两次的情况<br>
question: 我尚未进行两次访问  立即被驱逐 但假设该页实际上是热页  我希望将其保存在内存中<br>
解决这个问题的方法是  维护一个内存中的哈希表 用来记录以下信息</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">这是我最近从磁盘上置换出去的几页</li>
<li data-line="1" dir="auto">他们被访问的时间戳<br>
当我在页面刚被移除后再次检索它时  我至少对其历史有所了解  不会默认为无限大<br>
SQL Server和Postgre真正实现了这一点</li>
</ul></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="MySQL Approximate LRU-K" dir="auto" class="heading" id="MySQL_Approximate_LRU-K"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>MySQL Approximate LRU-K</h4><div class="heading-children"><div class="el-p"><p dir="auto">MySQL并没有完全采用LRUK算法  而是采用了一种近似的方法<br>
他们实现这一功能的方式是逻辑上划分LRU页面列表的链表<br>
包含两个区 -young List  -old List<br>
对于两个不同区域中的每一个  将拥有一个不同的头指针 指示着新条目插入的位置<br>
<span alt="Pasted image 20250214134858.png" src="Pasted image 20250214134858.png" class="internal-embed media-embed image-embed is-loaded" style="width: 400px; max-width: 100%;"><img alt="Pasted image 20250214134858.png" src="lib/media/pasted-image-20250214134858.png" style="width: 400px; max-width: 100%;"></span><br>
假设有一个query  要访问page1<br>
新页面  被插入 the head of the old list<br>
<span alt="Pasted image 20250214135112.png" src="Pasted image 20250214135112.png" class="internal-embed media-embed image-embed is-loaded" style="width: 500px; max-width: 100%;"><img alt="Pasted image 20250214135112.png" src="lib/media/pasted-image-20250214135112.png" style="width: 500px; max-width: 100%;"></span><br>
<span alt="Pasted image 20250214135133.png" src="Pasted image 20250214135133.png" class="internal-embed media-embed image-embed is-loaded" style="width: 500px; max-width: 100%;"><img alt="Pasted image 20250214135133.png" src="lib/media/pasted-image-20250214135133.png" style="width: 500px; max-width: 100%;"></span></p></div><div class="el-p"><p dir="auto">如果在old list中的页面 不被访问  会逐渐移至链表末尾  随后被淘汰<br>
如果再次被访问  会放入the head of the young list 然后把最后一个 挤进 old list<br>
<span alt="Pasted image 20250214135357.png" src="Pasted image 20250214135357.png" class="internal-embed media-embed image-embed is-loaded" style="width: 500px; max-width: 100%;"><img alt="Pasted image 20250214135357.png" src="lib/media/pasted-image-20250214135357.png" style="width: 500px; max-width: 100%;"></span><br>
<span alt="Pasted image 20250214135413.png" src="Pasted image 20250214135413.png" class="internal-embed media-embed image-embed is-loaded" style="width: 500px; max-width: 100%;"><img alt="Pasted image 20250214135413.png" src="lib/media/pasted-image-20250214135413.png" style="width: 500px; max-width: 100%;"></span></p></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="Better Policies: localization" dir="auto" class="heading" id="Better_Policies:_localization"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Better Policies: localization</h4><div class="heading-children"><div class="el-p"><p dir="auto">SQL Server 实现了 一系列优化 这些优化能追踪何时 如何 以及谁访问或引用了某个数据页，这可以确定 是否一次访问计数为一个不同的引用  是否应该更新间隔<br>
for example  在更新你的账户信息的时候 假设处于某种原因  那个事务对记录跟新了两次 SQL Server视为一次  但 Postgre视为两次<br>
Localization 本地化策略<br>
其核心思想是基于每个查询来决定哪些页面应该被驱逐出缓冲池，目的是最小化每个查询对缓冲池造成的“污染”，即避免某个查询加载的页面过多地占据缓冲池，影响其他查询的性能。<br>
系统需要记录一个查询已经访问了哪些页面。这样做可以帮助系统更好地做出决策，比如优先保留那些频繁访问的页面，或者在需要腾出空间时优先考虑移除那些只被当前查询短期使用的页面<br>
<strong>Postgres的做法</strong>：文中提到的例子指出，PostgreSQL数据库维护了一个小型的循环缓冲区（ring buffer），这个缓冲区是特定查询私有的。这意味着每个查询都有自己独立的一块小缓冲区来追踪它访问过的页面信息。循环缓冲区的设计有助于高效地管理和更新这些信息，而不需要消耗太多的额外资源</p></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="Better Policies: Priority Hints" dir="auto" class="heading" id="Better_Policies:_Priority_Hints"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Better Policies: Priority Hints</h4><div class="heading-children"><div class="el-p"><p dir="auto">优先级提示</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><strong>页面上下文的理解</strong>：DBMS能够识别并理解在查询执行过程中每个页面的角色和重要性。例如，某些页面可能因为频繁被访问或对事务完成至关重要而被认为更加重要。</li>
<li data-line="1" dir="auto"><strong>提供优先级提示</strong>：基于上述理解，DBMS可以为缓冲池提供指示，指出哪些页面应当被视为高优先级，意味着它们应该较少被驱逐出缓冲池；反之，低优先级的页面则可以在需要空间时优先考虑移除<br>
这种机制使得缓冲池管理不再仅仅是基于简单的LRU（最近最少使用）等算法，而是可以根据实际查询需求动态调整页面的优先级。<br>
example<br>
如果有一个多页的索引   并且收到的查询总是会插入新纪录 这些记录仅增加索引所基于的值的大小  那么我知道 我始终命中树的右侧<br>
<span alt="Pasted image 20250214141052.png" src="Pasted image 20250214141052.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250214141052.png" src="lib/media/pasted-image-20250214141052.png"></span></li>
</ul></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="Challenge: is whether they're dirty page" dir="auto" class="heading" id="Challenge:_is_whether_they're_dirty_page"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Challenge: is whether they're dirty page</h4><div class="heading-children"><div class="el-p"><p dir="auto">最简单的方法是  如果我所有的页面都是干净的  从缓冲池中驱逐他们就是什么都不做 只需要将页面引用放入page table中 -- 覆盖之前的内容<br>
如果所有页面都已经修改 或者想换出的页面已经被修改  就必须写入disk 确保其持久性和安全性<br>
实际上在刷新包含日志引用的脏页之前  必须确保日志记录先刷到disk<br>
是否需要违背LRU呢  因为 写回慢<br>
避免这一问题的一种方法是 -- 想要访问某一页时 不使写操作处于关键路径上 -- <strong>Background writing</strong><br>
在后台运行一个单独的线程  定期遍历页表 并确保日志写入磁盘<br>
-》 当安全写入脏页后 就可以驱逐该页 或者 取消dirty 标志</p></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="Disk I/O Scheduling" dir="auto" class="heading" id="Disk_I/O_Scheduling"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Disk I/O Scheduling</h3><div class="heading-children"><div class="el-p"><p dir="auto">在磁盘写入和读取时  实际上如何实现这一操作？<br>
当我们向文件系统发出读写调用时 假设我们是在文件系统上运行 而非原始分区  我们的数据系统之下有一系列层次   如操作系统 文件系统 硬件 ， 这些层级会巧妙地尝试通过重新排序和批处理处理IO请求，以明显最大化其能达到的带宽<br>
现代磁盘驱动器 固态硬盘(SSD)，非易失性内存快速驱动器 之所以迅速 部分原因在于拥有长队列 并能执行并行请求<br>
Challenge在于 数据系统之下的这些层次 并不知道实际上对应的是什么 他们只收到 读取写入某个位置的页面和命令<br>
大多数数据库 都建议放弃Linux调度器    使用FIFO策略   -- Oracle,Vertica, MySQL<br>
所以大多数数据系统会有一个自己的小型适配层 -- 跟踪哪些读写请求尚未完成 并从缓冲池管理器中获取  同时决定如何取消这些请求以优化性能</p></div><div class="el-p"><p dir="auto">Compute priority based on several factors</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">Sequential vs. Random IO</li>
<li data-line="1" dir="auto">Critical Path Task vs. Background Task</li>
<li data-line="2" dir="auto">Table vs. Index vs. Log vs. Ephemeral Data</li>
<li data-line="3" dir="auto">Transaction Information</li>
<li data-line="4" dir="auto">User-based SLAs</li>
</ul></div><div class="el-p"><p dir="auto">所以为了获得更好的性能 我们采用 <strong>direct I/O</strong>的方式<br>
对于大部分磁盘操作  你都需要通过操作系统API进行<br>
我们不希望操作系统维护自己的缓存  不希望操作系统对我们的读写进行缓冲</p></div><div class="el-p"><p dir="auto">如果我在文件系统进行读取  操作系统会 在所有运行的进程中维护自己的小型缓冲池 但我们希望绕过page Cache<br>
<span alt="Pasted image 20250214143931.png" src="Pasted image 20250214143931.png" class="internal-embed media-embed image-embed is-loaded" style="width: 200px; max-width: 100%;"><img alt="Pasted image 20250214143931.png" src="lib/media/pasted-image-20250214143931.png" style="width: 200px; max-width: 100%;"></span><br>
Postgre不这么做 因为 太早了 数据库</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">fwrite   其实是写入了page cache   OS决定什么时候刷新</li>
<li data-line="1" dir="auto">fsync    阻塞 直到硬件返回并告知 数据已经持久化</li>
<li data-line="2" dir="auto">哈哈哈哈哈 fsync error</li>
</ul></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="Other Memory Pools" dir="auto" class="heading" id="Other_Memory_Pools"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Other Memory Pools</h3><div class="heading-children"><div class="el-p"><p dir="auto">Sorting+Join Buffers：缓存住热点的数据<br>
Query Cache：执行结果的缓存<br>
Maintenance Buffers：维护缓存：查询缓存前提是数据没后发生变化<br>
Log Buffers：日志缓存，记录操作日志（读写磁盘代价很高，经常会记录一个中间状态）<br>
Dictionary Cache：字典缓存</p></div><div class="el-p"><embed src="lib/media/06-bufferpool-node.pdf" style="width: 100%; max-width: 100%; height: 800px;"></div><div class="mod-footer mod-ui"></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>